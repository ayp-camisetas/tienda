<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AyP Importados</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons (Versi√≥n Estable) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;700;900&display=swap');
        
        body { 
            font-family: 'Nunito', sans-serif; 
            background-color: #e0e5ec;
            color: #4a5568;
        }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* UTILIDADES NEUMORFISMO */
        .neu-flat {
            background: #e0e5ec;
            box-shadow: 9px 9px 16px rgb(163,177,198,0.6), -9px -9px 16px rgba(255,255,255, 0.5);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .neu-pressed {
            background: #e0e5ec;
            box-shadow: inset 6px 6px 10px 0 rgba(163,177,198, 0.7), inset -6px -6px 10px 0 rgba(255,255,255, 0.8);
            border-radius: 15px;
        }

        .neu-btn {
            background: #e0e5ec;
            box-shadow: 6px 6px 10px 0 rgba(163,177,198, 0.7), -6px -6px 10px 0 rgba(255,255,255, 0.8);
            border-radius: 50px;
            transition: all 0.2s ease;
            color: #4a5568;
            font-weight: 800;
        }
        
        .neu-btn:hover {
            transform: translateY(-2px);
            box-shadow: 8px 8px 12px 0 rgba(163,177,198, 0.7), -8px -8px 12px 0 rgba(255,255,255, 0.8);
            color: #0891b2;
        }

        .neu-btn:active {
            transform: translateY(1px);
            box-shadow: inset 4px 4px 8px 0 rgba(163,177,198, 0.7), inset -4px -4px 8px 0 rgba(255,255,255, 0.8);
        }

        .neu-btn-primary {
            background: #0891b2;
            color: white;
            box-shadow: 6px 6px 10px 0 rgba(163,177,198, 0.7), -6px -6px 10px 0 rgba(255,255,255, 0.8);
        }
        .neu-btn-primary:hover {
            background: #06b6d4;
            color: white;
        }

        .neu-input {
            background: #e0e5ec;
            box-shadow: inset 5px 5px 10px #a3b1c6, inset -5px -5px 10px #ffffff;
            border: none;
            border-radius: 12px;
            padding: 12px 16px;
            outline: none;
            transition: all 0.3s;
        }
        .neu-input:focus {
            box-shadow: inset 2px 2px 5px #a3b1c6, inset -2px -2px 5px #ffffff, 0 0 5px rgba(8, 145, 178, 0.3);
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
    </style>

    <!-- FIREBASE MODULES (v11.6.1 Stable) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, doc, getDocs, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAnrHBpTZTZnnzzdqMWiaKo-UQGhScxE2Y",
            authDomain: "ayp-camisetas-f1348.firebaseapp.com",
            projectId: "ayp-camisetas-f1348",
            storageBucket: "ayp-camisetas-f1348.firebasestorage.app",
            messagingSenderId: "135355835055",
            appId: "1:135355835055:web:29a768153319904a3d2a5a",
            measurementId: "G-PM6M1QV0NN"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.firebase = { auth, db, signInAnonymously, onAuthStateChanged, collection, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, doc, getDocs, getDoc };
        
        // ID FIJO para asegurar persistencia
        window.APP_ID = "ayp-store-v7-empty"; 
    </script>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        
        // --- CONFIGURACI√ìN ---
        const WHATSAPP_NUMBER = "5493515604303"; 
        const ADMIN_HASH = "MDYyNzA4"; // Clave: 062708
        const DEFAULT_LEAGUE_LOGO = "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi-tqx9482e9g6j0VIodmDN28aglSmHZFOOv2BTiX_A0CABdPrJWS3_WgWQm4cEIqoJmfTy5a0rsGb9b88QzVp-kJf0WYirNZMt1hQFAUi0M_-I1O7T93BmebBI3GfpJf4lGv42vCOar-c/d/LPF.png";

        const INITIAL_LEAGUES = [
            { id: 'todas', name: "Todas", logo: "https://cdn-icons-png.flaticon.com/512/55/55238.png" },
            { id: 'mundial', name: "Mundial", logo: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjnalN74so4om-iSDLjMukAB_NAFeQvLMEaCBlArWfL_hNClYYZBLpcIuzODwwEvy41KLxlJ_oQhNk1FOPlYq4Gx4Vdhc_DyqAxDLA9QaLiHtSm3yb3qNf8tgmPiGz0CQQAikiOEw4kuiyq082XjcpTngo7Lb5eo2omTxGOvMnyAaOJiFKS9hHIngvux_Q/s512/2026%20FIFA%20World%20Cup512x.png" },
            { id: 'premier', name: "Premier League", logo: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgkSAf6I2sP5AuBQq1YxsDh7Dg167gncu5PZwUvDVMXed1QQRyl9JQygpr_Jp5OJZdTrqUbjZWxUpu42nblIK1bFKpCf2t-XoyRJf4MMCVYRA24wAR6iQx78HOtwRSAazGguxHSZWJWmN0/s1600/PL.png" },
            { id: 'laliga', name: "La Liga", logo: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEinbYtI12_hBOhK9EyXGRsBQOidmCan94dOx5YMfNxY_55908K705MSKTNiKpuzxxR2IDWudsOqC09fa4J6Q72sv8bDrMkJGSZ-Wi1yR6jpMU02xT_j1I0zCbDWllCMzi5bvj6OXUxU6PBWneuWI5PlNWrw0hKiIT1wY5m_NQw0-C7bFi-c1fSwuvtHK-4/s256/LaLiga256x.png" },
            { id: 'seriea', name: "Serie A", logo: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjstHKDqnzLZIBFxQvjR-PNwyDf8iM31St1_igwYw50feQiVL_YhZ8W5Db3Gx6BN8uNoD3_JPRJ6S-CfTEFEXh_4WKR63NwSAWdSi2w1fMMXTZ5Cx0wiSBDg_x5XV3FNwKrD7e0EeGeC9k/s1600/Serie+A+Tim.png" },
            { id: 'bundesliga', name: "Bundesliga", logo: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhmscFmXe1ki5uWEoyhSRPDswEPgIIY43LQqHYugXc6HkuF8lHy1P7eBkQB1386ZKFbTPHo43aaD7mmk5NeDPAE60ISXdJPnKd5BhYKD6b4tyCoZp8R0YcXlj71b3kh9JohPoxivyAu6lE/s1600/Bundesliga.png" },
            { id: 'ligue1', name: "Ligue 1", logo: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiU3I0UcpOk2nXpxekhJtd7LlvNZMjrhM3Wr5NeqEzsDbteF-Atz-OT3qKqDk_bRbCELeVbGsD4MTJqb8qjb_pLXNyiXijrcyOT5xGaAVGl-nJM5ExVVdxorBzpKMJo17YT7R412xbU9cTlPeN6DuyCwyt_ycw49P33qgSfJFwPgT6DPysIjdRgFV9Kw7Y/s512/FRA.png" },
            { id: 'lpf', name: "LPF Argentina", logo: DEFAULT_LEAGUE_LOGO }
        ];

        const PREDEFINED_TEAMS = [
            "https://i.postimg.cc/MG36Q5nt/ajax.png", "https://i.postimg.cc/0Q68dSmg/arsenal.png", "https://i.postimg.cc/XJTn2vcM/atalanta.png", "https://i.postimg.cc/qR9pm7c5/athletic.png",
            "https://i.postimg.cc/sXBV9WWH/atlmadrid.png", "https://i.postimg.cc/k4VnFS8m/barcelona.png", "https://i.postimg.cc/HxfTSL0f/bayerleverkusen.png", "https://i.postimg.cc/xCk0ymmg/bayernmunchen.png",
            "https://i.postimg.cc/0QL9tNd1/benfica.png", "https://i.postimg.cc/sXBV9WW9/bodo-glimt.png", "https://i.postimg.cc/gJfGM0yC/borussiadortmund.png", "https://i.postimg.cc/hjHKCGbD/chelsea.png",
            "https://i.postimg.cc/xCW9sdyj/clubbrujas.png", "https://i.postimg.cc/fL6MHbjR/eintrachtfrankfurt.png", "https://i.postimg.cc/vBpGPm7K/fc-copenhague.png", "https://i.postimg.cc/k5YJbs2s/galatasaray.png",
            "https://i.postimg.cc/4dKJbccM/inter.png", "https://i.postimg.cc/qR9pm7XM/juventus.png", "https://i.postimg.cc/vB1QLnnf/kairat-almaty.png", "https://i.postimg.cc/k4VnFSS0/liverpool.png",
            "https://i.postimg.cc/DZW2dGGN/manchestercity.png", "https://i.postimg.cc/xCW9sdyd/monaco.png", "https://i.postimg.cc/XJZVc55s/napoli.png", "https://i.postimg.cc/mDcbN999/newcastle.png",
            "https://i.postimg.cc/W3Qs9463/olimpiquemarsella.png", "https://i.postimg.cc/mDcbN99X/olympiacos.png", "https://i.postimg.cc/tT1Xt66F/pafos.png", "https://i.postimg.cc/0Q68dSSc/psg.png",
            "https://i.postimg.cc/HxfTSL4j/psv.png", "https://i.postimg.cc/8CXp647H/qarabag.png", "https://i.postimg.cc/RF3MQtfz/realmadrid.png", "https://i.postimg.cc/KzKZrTLb/slavia-praga.png",
            "https://i.postimg.cc/3RP3LwCd/sporting.png", "https://i.postimg.cc/XJZVc558/tottenham.png", "https://i.postimg.cc/76CxMz7D/union-saint-gilloise.png", "https://i.postimg.cc/vBpGPmL1/villarreal.png"
        ];

        const SIZES_ADULT = ["XS", "S", "M", "L", "XL", "XXL", "3XL"];
        const SIZES_KIDS = ["6", "8", "10", "12", "14"];

        // BASE DE DATOS INICIAL VAC√çA
        const INITIAL_PRODUCTS = []; 
        const INITIAL_COUPONS = [];

        // --- SERVICIO FIREBASE ---
        const DB = {
            init: async (setProducts, setOrders, setLeagues, setCoupons) => {
                if(!window.firebase) return;
                const { auth, db, signInAnonymously, onAuthStateChanged, collection, onSnapshot, getDocs, doc, setDoc } = window.firebase;
                const APP_ID = window.APP_ID;

                await signInAnonymously(auth).catch(console.error);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        // Productos
                        const prodRef = collection(db, 'artifacts', APP_ID, 'public', 'data', 'products');
                        onSnapshot(prodRef, (snapshot) => {
                            if(!snapshot.empty) {
                                setProducts(snapshot.docs.map(d => {
                                    const data = d.data();
                                    if (!data.images && data.image) data.images = [data.image];
                                    return {id: d.id, ...data};
                                }));
                            } else {
                                setProducts([]);
                            }
                        });

                        // Ordenes
                        const orderRef = collection(db, 'artifacts', APP_ID, 'public', 'data', 'orders');
                        onSnapshot(orderRef, (snapshot) => {
                            setOrders(snapshot.docs.map(d => ({id: d.id, ...d.data()})));
                        });

                        // Ligas
                        const leagueRef = collection(db, 'artifacts', APP_ID, 'public', 'data', 'leagues');
                        onSnapshot(leagueRef, (snapshot) => {
                            if(snapshot.empty) {
                                INITIAL_LEAGUES.forEach(l => setDoc(doc(leagueRef, String(l.id)), l));
                            } else {
                                setLeagues(snapshot.docs.map(d => ({id: d.id, ...d.data()})));
                            }
                        });

                        // Cupones
                        const couponsRef = collection(db, 'artifacts', APP_ID, 'public', 'data', 'coupons');
                        onSnapshot(couponsRef, (snapshot) => {
                            if(!snapshot.empty) {
                                setCoupons(snapshot.docs.map(d => ({id: d.id, ...d.data()})));
                            } else {
                                setCoupons([]);
                            }
                        });
                    }
                });
            },
            addProduct: async (product) => {
                const { db, setDoc, doc } = window.firebase;
                const APP_ID = window.APP_ID;
                await setDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'products', String(product.id)), product);
            },
            deleteProduct: async (id) => {
                const { db, deleteDoc, doc } = window.firebase;
                const APP_ID = window.APP_ID;
                await deleteDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'products', String(id)));
            },
            updateStock: async (product) => {
                const { db, updateDoc, doc } = window.firebase;
                const APP_ID = window.APP_ID;
                await updateDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'products', String(product.id)), { stock: product.stock });
            },
            addOrder: async (order) => {
                const { db, setDoc, doc } = window.firebase;
                const APP_ID = window.APP_ID;
                await setDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'orders', String(order.id)), order);
            },
            updateOrderStatus: async (orderId, status) => {
                const { db, updateDoc, doc } = window.firebase;
                const APP_ID = window.APP_ID;
                await updateDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'orders', String(orderId)), { status: status });
            },
            addLeague: async (league) => {
                const { db, setDoc, doc } = window.firebase;
                const APP_ID = window.APP_ID;
                await setDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'leagues', String(league.id)), league);
            },
            deleteLeague: async (id) => {
                const { db, deleteDoc, doc } = window.firebase;
                const APP_ID = window.APP_ID;
                await deleteDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'leagues', String(id)));
            },
            addCoupon: async (coupon) => {
                const { db, setDoc, doc } = window.firebase;
                const APP_ID = window.APP_ID;
                await setDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'coupons', String(coupon.id)), coupon);
            },
            deleteCoupon: async (id) => {
                const { db, deleteDoc, doc } = window.firebase;
                const APP_ID = window.APP_ID;
                await deleteDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'coupons', String(id)));
            }
        };

        // --- COMPONENTES ---

        const Icon = ({ name, size = 24, className }) => {
            const [svg, setSvg] = useState(null);
            useEffect(() => {
                if (!window.lucide) return;
                const iconName = name.split('-').map(p => p.charAt(0).toUpperCase() + p.slice(1)).join('');
                const iconDef = window.lucide.icons[iconName];
                if (iconDef) {
                    try {
                        const element = window.lucide.createElement(iconDef);
                        element.setAttribute('width', size);
                        element.setAttribute('height', size);
                        element.setAttribute('stroke-width', 2);
                        if (className) element.setAttribute('class', className);
                        setSvg(element.outerHTML);
                    } catch (e) { console.warn(e); }
                }
            }, [name, size, className]);
            if (!svg) return <span className={className} style={{ width: size, height: size, display: 'inline-block' }}></span>;
            return <span dangerouslySetInnerHTML={{ __html: svg }} style={{ display: 'inline-flex', alignItems: 'center' }} />;
        };

        const LoginModal = ({ isOpen, onClose, onLogin }) => {
            const [pass, setPass] = useState("");
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[70] flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm">
                    <div className="neu-flat p-8 w-full max-w-sm relative animate-fade-in flex flex-col items-center">
                        <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><Icon name="x" size={24}/></button>
                        <div className="w-16 h-16 rounded-full neu-pressed flex items-center justify-center mb-4 text-cyan-600"><Icon name="shield-check" size={32} /></div>
                        <h3 className="text-2xl font-black text-slate-700 mb-6 text-center">Admin Access</h3>
                        <form onSubmit={(e) => { e.preventDefault(); onLogin(pass); setPass(""); }} className="w-full">
                            <input autoFocus type="password" placeholder="C√≥digo..." className="neu-input w-full mb-6 text-center text-lg tracking-widest" value={pass} onChange={(e) => setPass(e.target.value)} />
                            <button type="submit" className="neu-btn neu-btn-primary w-full py-4 rounded-xl text-lg uppercase tracking-wide">Desbloquear</button>
                        </form>
                    </div>
                </div>
            );
        };

        const ProductCard = ({ product, onAdd, leagues }) => {
            const totalStock = product.stock && typeof product.stock === 'object' ? Object.values(product.stock).reduce((a, b) => a + b, 0) : 0;
            const mainImage = product.images && product.images.length > 0 ? product.images[0] : (product.image || "");
            const hasDiscount = product.discount && product.discount > 0;
            const finalPrice = hasDiscount ? product.price * (1 - product.discount / 100) : product.price;
            
            const leagueObj = leagues.find(l => l.name === product.league);
            const leagueLogo = leagueObj ? leagueObj.logo : null;

            return (
                <div className="neu-flat overflow-hidden group relative transition-all duration-300 hover:-translate-y-2">
                    <div className="relative h-48 md:h-72 p-3 md:p-6 flex items-center justify-center bg-transparent">
                        <div className="absolute inset-0 bg-gradient-to-tr from-white/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        
                        <img src={mainImage} alt={product.name} className={`w-full h-full object-contain drop-shadow-xl z-10 transition-transform duration-500 group-hover:scale-110 ${totalStock <= 0 ? 'grayscale opacity-60' : ''}`} />
                        
                        <span className="absolute top-2 right-2 md:top-4 md:right-4 bg-[#e0e5ec] text-slate-500 text-[8px] md:text-[10px] font-bold px-2 py-1 rounded-full uppercase tracking-wider shadow-[3px_3px_6px_#b8b9be,-3px_-3px_6px_#ffffff] z-20">
                            {product.league}
                        </span>
                        
                        <div className="absolute bottom-2 right-2 md:bottom-4 md:right-4 flex gap-1 md:gap-2 z-20">
                            {leagueLogo && (
                                <div className="w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center neu-flat p-1 md:p-2">
                                    <img src={leagueLogo} className="w-full h-full object-contain" alt="Liga" />
                                </div>
                            )}
                            {product.teamLogo && (
                                <div className="w-10 h-10 md:w-14 md:h-14 rounded-full flex items-center justify-center neu-flat p-1 md:p-2">
                                    <img src={product.teamLogo} className="w-full h-full object-contain" alt="Escudo" />
                                </div>
                            )}
                        </div>

                        {hasDiscount && (
                            <div className="absolute top-2 left-2 md:top-4 md:left-4 bg-red-500 text-white text-[8px] md:text-[10px] font-bold px-2 py-1 rounded-full shadow-lg z-20 animate-pulse">
                                {product.discount}% OFF
                            </div>
                        )}
                    </div>

                    <div className="p-3 md:p-5">
                        <h3 className="font-extrabold text-sm md:text-lg text-slate-700 truncate mb-1">{product.name}</h3>
                        <div className="flex justify-between items-end mt-2 md:mt-4">
                            <div className="flex flex-col">
                                <span className="text-[10px] md:text-xs text-slate-400 font-bold uppercase mb-0.5 md:mb-1">Precio</span>
                                <div className="flex flex-col">
                                    {hasDiscount && <span className="text-[10px] md:text-xs text-red-400 line-through decoration-red-400">${product.price.toLocaleString()}</span>}
                                    <span className={`text-lg md:text-2xl font-black ${hasDiscount ? 'text-red-500' : 'text-slate-800'}`}>${finalPrice.toLocaleString()}</span>
                                </div>
                            </div>
                            <button 
                                onClick={(e) => { e.stopPropagation(); onAdd(product); }}
                                disabled={totalStock <= 0}
                                className={`w-8 h-8 md:w-12 md:h-12 rounded-full flex items-center justify-center transition-all ${totalStock > 0 ? 'neu-btn text-cyan-600 hover:text-cyan-500' : 'neu-pressed text-slate-300 cursor-not-allowed'}`}
                            >
                                <Icon name="shopping-cart" size={16} className="md:w-5 md:h-5" />
                            </button>
                        </div>
                        {totalStock <= 0 && (
                            <div className="mt-2 text-center text-red-500 text-xs font-black uppercase tracking-widest border-t border-red-200 pt-2">
                                Sin Stock
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const ProductModal = ({ product, isOpen, onClose, onAddToCart, leagues }) => {
            const [size, setSize] = useState("");
            const [imgIndex, setImgIndex] = useState(0);
            
            const availableSizes = product?.type === 'kid' ? SIZES_KIDS : SIZES_ADULT;
            const images = product?.images && product.images.length > 0 ? product.images : (product?.image ? [product.image] : []);
            
            if (!isOpen || !product) return null;

            const getStock = (s) => (product.stock && product.stock[s]) ? product.stock[s] : 0;
            const hasDiscount = product.discount && product.discount > 0;
            const finalPrice = hasDiscount ? product.price * (1 - product.discount / 100) : product.price;
            
            const leagueObj = leagues.find(l => l.name === product.league);
            const leagueLogo = leagueObj ? leagueObj.logo : null;

            const handleShare = () => {
                const url = `${window.location.origin}${window.location.pathname}?producto=${product.id}`;
                if (navigator.share) {
                    navigator.share({
                        title: product.name,
                        text: `Mira esta camiseta de ${product.name} en AyP Store`,
                        url: url,
                    }).catch(console.error);
                } else {
                    navigator.clipboard.writeText(url).then(() => alert("¬°Enlace copiado al portapapeles!"));
                }
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-md animate-fade-in">
                    <div className="neu-flat w-full max-w-5xl overflow-hidden flex flex-col md:flex-row relative max-h-[90vh]">
                        <div className="absolute top-4 right-4 z-30 flex gap-2">
                            <button onClick={handleShare} className="neu-btn w-10 h-10 flex items-center justify-center text-cyan-600 bg-[#e0e5ec] hover:text-cyan-700" title="Copiar Link">
                                <Icon name="share-2" size={20} />
                            </button>
                            <button onClick={onClose} className="neu-btn w-10 h-10 flex items-center justify-center text-slate-500 hover:text-red-500">
                                <Icon name="x" size={20} />
                            </button>
                        </div>
                        
                        <div className="w-full md:w-1/2 p-6 flex flex-col items-center justify-center relative bg-[#e0e5ec]">
                            <div className="absolute w-64 h-64 rounded-full neu-pressed opacity-50 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"></div>
                            
                            <img src={images[imgIndex]} className="w-full max-h-[350px] object-contain drop-shadow-2xl relative z-10 transition-all duration-300" />
                            
                            {images.length > 1 && (
                                <div className="flex gap-2 mt-4 z-20 overflow-x-auto p-2 w-full justify-center">
                                    {images.map((img, i) => (
                                        <button 
                                            key={i} 
                                            onClick={() => setImgIndex(i)}
                                            className={`w-14 h-14 rounded-lg border-2 overflow-hidden transition-all ${imgIndex === i ? 'border-cyan-500 opacity-100 scale-110' : 'border-transparent opacity-60 hover:opacity-100'}`}
                                        >
                                            <img src={img} className="w-full h-full object-cover" />
                                        </button>
                                    ))}
                                </div>
                            )}
                        </div>
                        
                        <div className="w-full md:w-1/2 p-8 md:p-12 flex flex-col overflow-y-auto bg-[#e0e5ec]">
                            <div className="flex items-center gap-3 mb-4">
                                <span className="neu-pressed px-3 py-1 rounded-full text-xs font-bold text-cyan-600 uppercase">{product.league}</span>
                                <span className={`neu-pressed px-3 py-1 rounded-full text-xs font-bold uppercase ${product.type==='kid' ? 'text-pink-500' : 'text-blue-500'}`}>
                                    {product.type === 'kid' ? 'Ni√±os' : 'Adultos'}
                                </span>
                                {leagueLogo && <img src={leagueLogo} className="w-8 h-8 object-contain drop-shadow-sm" title="Liga"/>}
                                {product.teamLogo && <img src={product.teamLogo} className="w-8 h-8 object-contain drop-shadow-sm" title="Equipo"/>}
                            </div>
                            <h2 className="text-3xl md:text-5xl font-black text-slate-800 mb-2 leading-tight">{product.name}</h2>
                            
                            <div className="flex items-baseline gap-3 mb-8">
                                <p className={`text-4xl font-bold tracking-tight ${hasDiscount ? 'text-red-500' : 'text-slate-700'}`}>${finalPrice.toLocaleString()}</p>
                                {hasDiscount && <p className="text-xl text-slate-400 line-through decoration-slate-400">${product.price.toLocaleString()}</p>}
                                {hasDiscount && <span className="text-xs bg-red-100 text-red-600 px-2 py-1 rounded font-bold">-{product.discount}%</span>}
                            </div>

                            <div className="mb-10">
                                <div className="flex justify-between items-center mb-4">
                                    <label className="text-sm font-bold text-slate-500 uppercase tracking-widest">Seleccionar Talle</label>
                                    {size && <span className={`text-xs font-bold ${getStock(size) > 5 ? 'text-green-600' : 'text-red-500'}`}>{getStock(size)} disponibles</span>}
                                </div>
                                <div className="grid grid-cols-5 gap-3">
                                    {availableSizes.map(s => {
                                        const st = getStock(s);
                                        return (
                                            <button 
                                                key={s} 
                                                onClick={() => setSize(s)}
                                                disabled={st <= 0}
                                                className={`aspect-square rounded-2xl flex items-center justify-center font-bold transition-all text-sm relative ${size === s ? 'neu-flat bg-slate-200 text-cyan-600 border-2 border-cyan-400' : 'neu-btn text-slate-500'} ${st <= 0 ? 'opacity-40 cursor-not-allowed' : ''}`}
                                            >
                                                {s}
                                                {st <= 0 && <span className="absolute inset-0 flex items-center justify-center text-red-400 opacity-80"><Icon name="x" size={16}/></span>}
                                            </button>
                                        )
                                    })}
                                </div>
                            </div>
                            <button 
                                disabled={!size || getStock(size) <= 0}
                                onClick={() => { onAddToCart(product, size); onClose(); setSize(""); }}
                                className={`w-full py-5 rounded-2xl font-black text-lg flex items-center justify-center gap-3 transition-all uppercase tracking-wider ${size ? 'neu-btn-primary transform hover:-translate-y-1' : 'neu-pressed text-slate-400 cursor-not-allowed'}`}
                            >
                                <Icon name="shopping-bag" /> {size ? (getStock(size) > 0 ? 'Agregar al Pedido' : 'Sin Stock') : 'Elige un talle'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const Sidebar = ({ isOpen, onClose, onSelectCategory, activeCategory, leagues }) => (
            <>
                <div className={`fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 transition-opacity duration-300 ${isOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'}`} onClick={onClose} />
                <div className={`fixed inset-y-0 left-0 w-80 bg-[#e0e5ec] z-50 shadow-2xl transform transition-transform duration-300 flex flex-col ${isOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                    <div className="p-8 flex justify-between items-center bg-[#e0e5ec]">
                        <img src="https://i.postimg.cc/9fx1vwqg/Logo-Ay-P.png" className="h-10 object-contain mix-blend-multiply opacity-80" alt="AyP Logo"/>
                        <button onClick={onClose} className="neu-btn w-10 h-10 flex items-center justify-center text-slate-500"><Icon name="x" size={20}/></button>
                    </div>
                    <div className="flex-1 overflow-y-auto p-6 space-y-4">
                        <h3 className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4 ml-2">Ligas</h3>
                        {leagues.map(league => (
                            <button 
                                key={league.id}
                                onClick={() => { onSelectCategory(league.name); onClose(); }}
                                className={`w-full flex items-center gap-4 p-4 rounded-2xl transition-all ${activeCategory === league.name ? 'neu-pressed text-cyan-700 font-bold' : 'neu-btn text-slate-600'}`}
                            >
                                <div className="w-8 h-8 flex items-center justify-center">
                                    <img src={league.logo} className="w-full h-full object-contain" alt={league.name} />
                                </div>
                                <span>{league.name}</span>
                            </button>
                        ))}
                    </div>
                    <div className="p-6 border-t border-slate-200/50 space-y-3">
                        <a href={`https://wa.me/${WHATSAPP_NUMBER}`} target="_blank" className="w-full flex items-center justify-center gap-2 neu-btn p-3 text-green-600 font-bold hover:text-green-500 transition-colors">
                            <Icon name="message-circle" size={20} /> Contactar WhatsApp
                        </a>
                        <a href="https://www.instagram.com/ayp_importados/?hl=es" target="_blank" className="w-full flex items-center justify-center gap-2 neu-btn p-3 text-pink-600 font-bold hover:text-pink-500 transition-colors">
                            <Icon name="instagram" size={20} /> Seguir en Instagram
                        </a>
                    </div>
                </div>
            </>
        );

        const CartSidebar = ({ isOpen, onClose, cart, updateQty, remove, total, onCreateOrder, products, coupons }) => {
            const [showForm, setShowForm] = useState(false);
            const [buyer, setBuyer] = useState({ name: "", phone: "", location: "" });
            const [couponCode, setCouponCode] = useState("");
            const [discount, setDiscount] = useState(0);

            const finalTotal = total * (1 - discount / 100);

            const checkStock = (id, size, qty) => {
                const prod = products.find(p => p.id === id);
                if (!prod || !prod.stock || !prod.stock[size]) return false;
                return prod.stock[size] >= qty;
            };

            const handleApplyCoupon = () => {
                const found = coupons.find(c => c.code.toUpperCase() === couponCode.toUpperCase());
                if (found) {
                    setDiscount(found.discount);
                    alert(`¬°Cup√≥n ${found.code} aplicado! ${found.discount}% de descuento.`);
                } else {
                    alert("Cup√≥n inv√°lido.");
                    setDiscount(0);
                }
            };

            const handleSubmitOrder = async (e) => {
                e.preventDefault();
                if(cart.length === 0) return;
                
                const orderId = `PED-${Math.floor(1000 + Math.random() * 9000)}`;
                const date = new Date().toLocaleString();
                
                const newOrder = { 
                    id: orderId, 
                    date: date, 
                    items: cart, 
                    subtotal: total,
                    discountPercent: discount,
                    total: finalTotal,
                    status: 'Pendiente',
                    buyer: buyer 
                };
                
                try {
                    await DB.addOrder(newOrder);
                    onCreateOrder(newOrder);
                    
                    let message = `Hola AyP! üëã%0A*NUEVO PEDIDO: ${orderId}*%0A`;
                    message += `üë§ *Cliente:* ${buyer.name}%0A`;
                    message += `üìç *Ubicaci√≥n:* ${buyer.location}%0A`;
                    message += `üì± *Tel:* ${buyer.phone}%0A%0A`;
                    message += `*DETALLE DEL PEDIDO:*%0A`;
                    cart.forEach(item => { message += `üëï ${item.name} (${item.size}) x${item.qty}%0A`; });
                    if(discount > 0) message += `%0AüéüÔ∏è *Descuento:* ${discount}%%0A`;
                    message += `%0Aüí∞ *TOTAL A PAGAR: $${finalTotal.toLocaleString()}*`;
                    
                    window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${message}`, '_blank');
                    
                    setBuyer({ name: "", phone: "", location: "" });
                    setCouponCode("");
                    setDiscount(0);
                    setShowForm(false);
                    onClose();
                } catch(error) {
                    alert("Error al procesar el pedido. Intenta nuevamente.");
                    console.error(error);
                }
            };

            return (
                <div className={`fixed inset-0 z-50 transition-all duration-300 ${isOpen ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'}`}>
                    <div className="absolute inset-0 bg-slate-900/50 backdrop-blur-sm" onClick={onClose} />
                    <div className={`absolute right-0 top-0 h-full w-full max-w-md bg-[#e0e5ec] shadow-2xl transform transition-transform duration-300 flex flex-col ${isOpen ? 'translate-x-0' : 'translate-x-full'}`}>
                        <div className="p-6 flex justify-between items-center">
                            <h2 className="text-2xl font-black text-slate-700 flex items-center gap-3">
                                {showForm ? <button onClick={() => setShowForm(false)}><Icon name="arrow-left"/></button> : <Icon name="shopping-cart" className="text-cyan-600"/>}
                                {showForm ? 'Datos de Env√≠o' : 'Tu Carrito'}
                            </h2>
                            <button onClick={onClose} className="neu-btn w-10 h-10 flex items-center justify-center text-slate-500"><Icon name="x" size={20}/></button>
                        </div>
                        
                        {!showForm ? (
                            <>
                                <div className="flex-1 overflow-y-auto p-6 space-y-6">
                                    {cart.length === 0 ? (
                                        <div className="text-center py-20 opacity-50">
                                            <div className="neu-pressed w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6 text-slate-400">
                                                <Icon name="shopping-bag" size={40}/>
                                            </div>
                                            <p className="font-bold text-slate-500">Tu carrito est√° vac√≠o.</p>
                                        </div>
                                    ) : (
                                        cart.map((item, idx) => {
                                            const itemPrice = item.discount && item.discount > 0 ? item.price * (1 - item.discount/100) : item.price;
                                            return (
                                                <div key={`${item.id}-${item.size}`} className="neu-flat p-4 flex gap-4 items-center">
                                                    <div className="w-16 h-16 neu-pressed rounded-xl p-2 flex items-center justify-center bg-white/20">
                                                        <img src={item.images ? item.images[0] : item.image} className="w-full h-full object-contain" />
                                                    </div>
                                                    <div className="flex-1 min-w-0">
                                                        <h4 className="font-bold text-slate-800 text-sm truncate">{item.name}</h4>
                                                        <p className="text-xs text-slate-500 mb-2">Talle: {item.size}</p>
                                                        <div className="flex justify-between items-center">
                                                            <span className="font-bold text-cyan-700">${itemPrice.toLocaleString()}</span>
                                                            <div className="flex items-center gap-2">
                                                                <button onClick={() => updateQty(item.id, item.size, -1)} className="neu-btn w-6 h-6 flex items-center justify-center text-xs font-bold">-</button>
                                                                <span className="text-xs font-bold w-4 text-center">{item.qty}</span>
                                                                <button onClick={() => {
                                                                    if(checkStock(item.id, item.size, item.qty + 1)) updateQty(item.id, item.size, 1);
                                                                    else alert("¬°M√°ximo stock disponible alcanzado!");
                                                                }} className="neu-btn w-6 h-6 flex items-center justify-center text-xs font-bold">+</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <button onClick={() => remove(item.id, item.size)} className="text-red-400 hover:text-red-600 p-2"><Icon name="trash-2" size={18}/></button>
                                                </div>
                                            );
                                        })
                                    )}
                                </div>
                                <div className="p-8 neu-pressed m-4 rounded-3xl">
                                    <div className="mb-4 flex gap-2">
                                        <input 
                                            placeholder="C√≥digo Descuento" 
                                            className="neu-input flex-1 text-sm" 
                                            value={couponCode} 
                                            onChange={e => setCouponCode(e.target.value)}
                                        />
                                        <button onClick={handleApplyCoupon} className="neu-btn px-4 text-xs font-bold text-cyan-700">APLICAR</button>
                                    </div>

                                    <div className="space-y-1 mb-4 text-right">
                                        <div className="flex justify-between text-sm text-slate-500"><span>Subtotal</span> <span>${total.toLocaleString()}</span></div>
                                        {discount > 0 && <div className="flex justify-between text-sm text-green-600 font-bold"><span>Descuento ({discount}%)</span> <span>-${(total - finalTotal).toLocaleString()}</span></div>}
                                        <div className="flex justify-between text-xl font-black text-slate-800 mt-2">
                                            <span>Total</span>
                                            <span>${finalTotal.toLocaleString()}</span>
                                        </div>
                                    </div>
                                    <button onClick={() => setShowForm(true)} disabled={cart.length === 0} className="neu-btn-primary w-full py-4 rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                                        INICIAR COMPRA <Icon name="arrow-right" size={20}/>
                                    </button>
                                </div>
                            </>
                        ) : (
                            <form onSubmit={handleSubmitOrder} className="flex-1 flex flex-col p-6 animate-fade-in">
                                <div className="flex-1 space-y-4">
                                    <div>
                                        <label className="text-xs font-bold text-slate-500 uppercase ml-1 mb-1 block">Nombre Completo</label>
                                        <input required className="neu-input w-full" placeholder="Ej: Juan P√©rez" value={buyer.name} onChange={e => setBuyer({...buyer, name: e.target.value})} />
                                    </div>
                                    <div>
                                        <label className="text-xs font-bold text-slate-500 uppercase ml-1 mb-1 block">WhatsApp</label>
                                        <input required type="tel" className="neu-input w-full" placeholder="Ej: 11 1234 5678" value={buyer.phone} onChange={e => setBuyer({...buyer, phone: e.target.value})} />
                                    </div>
                                    <div>
                                        <label className="text-xs font-bold text-slate-500 uppercase ml-1 mb-1 block">Provincia / Ciudad</label>
                                        <input required className="neu-input w-full" placeholder="Ej: C√≥rdoba, Capital" value={buyer.location} onChange={e => setBuyer({...buyer, location: e.target.value})} />
                                    </div>
                                    
                                    <div className="neu-pressed p-4 rounded-xl mt-6">
                                        <h4 className="font-bold text-slate-700 mb-2 border-b border-slate-200 pb-2">Resumen</h4>
                                        <div className="flex justify-between text-sm text-slate-600 mb-1"><span>Productos:</span> <span>{cart.reduce((a,c)=>a+c.qty,0)} un.</span></div>
                                        <div className="flex justify-between text-xl font-black text-slate-800 mt-2"><span>Total:</span> <span>${finalTotal.toLocaleString()}</span></div>
                                    </div>
                                </div>
                                
                                <button type="submit" className="neu-btn-primary w-full py-4 rounded-xl font-bold flex items-center justify-center gap-2 mt-4 shadow-lg shadow-green-500/30 bg-green-600 hover:bg-green-500">
                                    <Icon name="message-circle" /> CONFIRMAR Y PAGAR
                                </button>
                            </form>
                        )}
                    </div>
                </div>
            );
        };

        const AdminPanel = ({ isOpen, onClose, products, orders, leagues, coupons }) => {
            const [form, setForm] = useState({ id: null, name: "", price: "", discount: 0, league: "Mundial", type: "adult", imagesStr: "", teamLogo: "" });
            const [stocks, setStocks] = useState({});
            const [leagueForm, setLeagueForm] = useState({ name: "", logo: "" });
            const [couponForm, setCouponForm] = useState({ code: "", discount: "" });
            const [activeTab, setActiveTab] = useState('inventory'); 
            const [logoMode, setLogoMode] = useState('predefined'); 

            useEffect(() => {
                const sizes = form.type === 'kid' ? SIZES_KIDS : SIZES_ADULT;
                const newStocks = {};
                sizes.forEach(s => newStocks[s] = (stocks[s] !== undefined ? stocks[s] : 0));
                setStocks(newStocks);
            }, [form.type]);

            if (!isOpen) return null;

            const handleEditProduct = (prod) => {
                const imgs = prod.images && prod.images.length > 0 ? prod.images : (prod.image ? [prod.image] : []);
                setForm({
                    id: String(prod.id),
                    name: prod.name,
                    price: prod.price,
                    discount: prod.discount || 0,
                    league: prod.league,
                    type: prod.type || 'adult',
                    imagesStr: imgs.join(', '),
                    teamLogo: prod.teamLogo || ""
                });
                
                const loadedStocks = prod.stock || {};
                const sizes = (prod.type || 'adult') === 'kid' ? SIZES_KIDS : SIZES_ADULT;
                const safeStocks = {};
                sizes.forEach(s => safeStocks[s] = loadedStocks[s] || 0);
                setStocks(safeStocks);
                setActiveTab('inventory');
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                const prodId = form.id || String(Date.now());
                const imagesArray = form.imagesStr.split(',').map(s => s.trim()).filter(s => s !== "");
                
                const newProduct = { 
                    ...form, 
                    id: prodId, 
                    price: Number(form.price), 
                    discount: Number(form.discount),
                    stock: stocks,
                    images: imagesArray,
                    image: imagesArray.length > 0 ? imagesArray[0] : ""
                };
                delete newProduct.imagesStr;

                await DB.addProduct(newProduct);
                
                setForm({ id: null, name: "", price: "", discount: 0, league: "Mundial", type: "adult", imagesStr: "", teamLogo: "" });
                setStocks({});
                alert(form.id ? "Producto actualizado" : "Producto creado");
            };

            const handleLeagueSubmit = async (e) => {
                e.preventDefault();
                const logoToUse = leagueForm.logo.trim() === "" ? DEFAULT_LEAGUE_LOGO : leagueForm.logo;
                const newLeague = { id: String(Date.now()), name: leagueForm.name, logo: logoToUse };
                await DB.addLeague(newLeague);
                setLeagueForm({ name: "", logo: "" });
                alert("Liga Agregada");
            };

            const handleCouponSubmit = async (e) => {
                e.preventDefault();
                const newCoupon = { id: String(Date.now()), code: couponForm.code.toUpperCase(), discount: Number(couponForm.discount) };
                await DB.addCoupon(newCoupon);
                setCouponForm({ code: "", discount: "" });
                alert("Cup√≥n Agregado");
            };

            const handleDelete = async (id) => { if(confirm("¬øEliminar?")) await DB.deleteProduct(id); };
            const handleDeleteLeague = async (id) => { if(confirm("¬øEliminar Liga?")) await DB.deleteLeague(id); };
            const handleDeleteCoupon = async (id) => { if(confirm("¬øEliminar Cup√≥n?")) await DB.deleteCoupon(id); };

            const handleProcessOrder = async (order) => {
                if(!confirm(`¬øConfirmar venta ${order.id} y descontar stock?`)) return;
                try {
                    const { db, doc, getDoc } = window.firebase;
                    const APP_ID = window.APP_ID;
                    let possible = true;

                    for(let item of order.items) {
                        const prodRef = doc(db, 'artifacts', APP_ID, 'public', 'data', 'products', String(item.id));
                        const prodSnap = await getDoc(prodRef);
                        
                        if(!prodSnap.exists()) {
                            alert(`Error: El producto ${item.name} (ID: ${item.id}) ya no existe.`);
                            possible = false; 
                            break;
                        }
                        
                        const stockData = prodSnap.data().stock;
                        const currentStock = stockData && stockData[item.size] ? stockData[item.size] : 0;
                        
                        if(currentStock < item.qty) {
                            alert(`Problema con stock de ${item.name}. Talle ${item.size} tiene ${currentStock}, necesitas ${item.qty}`); 
                            possible = false; 
                            break;
                        }
                    }

                    if(possible) {
                        for(let item of order.items) {
                            const prodRef = doc(db, 'artifacts', APP_ID, 'public', 'data', 'products', String(item.id));
                            const prodSnap = await getDoc(prodRef);
                            
                            if (prodSnap.exists()) {
                                const prodData = prodSnap.data();
                                const newStock = { ...prodData.stock };
                                newStock[item.size] = (newStock[item.size] || 0) - item.qty;
                                await DB.updateStock({ id: item.id, stock: newStock });
                            }
                        }
                        await DB.updateOrderStatus(order.id, 'Completado');
                        alert("Venta confirmada correctamente");
                    }
                } catch (error) { 
                    console.error("Error completo:", error); 
                    alert("Error al procesar. Revisa la consola."); 
                }
            };

            const sizesToRender = form.type === 'kid' ? SIZES_KIDS : SIZES_ADULT;
            const previewImages = form.imagesStr.split(',').map(s => s.trim()).filter(s => s !== "");
            
            const calculatedPrice = form.price && form.discount 
                ? Number(form.price) * (1 - Number(form.discount)/100) 
                : Number(form.price);

            return (
                <div className="fixed inset-0 z-[60] bg-[#e0e5ec] overflow-y-auto animate-fade-in">
                    <div className="max-w-7xl mx-auto p-4 md:p-8">
                        <div className="flex justify-between items-center mb-8 sticky top-0 bg-[#e0e5ec] z-10 py-4 shadow-sm md:shadow-none">
                            <h2 className="text-3xl font-black flex items-center gap-3 text-slate-700"><Icon name="shield" className="text-cyan-600"/> Admin Panel</h2>
                            <div className="flex gap-4">
                                <div className="neu-pressed p-1 rounded-xl flex overflow-x-auto">
                                    <button onClick={() => setActiveTab('inventory')} className={`px-4 py-2 rounded-lg font-bold text-sm whitespace-nowrap transition-all ${activeTab==='inventory' ? 'neu-flat text-cyan-700' : 'text-slate-400'}`}>Inventario</button>
                                    <button onClick={() => setActiveTab('orders')} className={`px-4 py-2 rounded-lg font-bold text-sm whitespace-nowrap transition-all ${activeTab==='orders' ? 'neu-flat text-cyan-700' : 'text-slate-400'}`}>Pedidos</button>
                                    <button onClick={() => setActiveTab('leagues')} className={`px-4 py-2 rounded-lg font-bold text-sm whitespace-nowrap transition-all ${activeTab==='leagues' ? 'neu-flat text-cyan-700' : 'text-slate-400'}`}>Ligas</button>
                                    <button onClick={() => setActiveTab('coupons')} className={`px-4 py-2 rounded-lg font-bold text-sm whitespace-nowrap transition-all ${activeTab==='coupons' ? 'neu-flat text-cyan-700' : 'text-slate-400'}`}>Cupones</button>
                                </div>
                                <button onClick={onClose} className="neu-btn px-4 rounded-xl font-bold text-slate-500 hover:text-red-500"><Icon name="log-out" size={20}/></button>
                            </div>
                        </div>

                        {activeTab === 'inventory' && (
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <div className="lg:col-span-1 neu-flat p-6 h-fit sticky top-24">
                                    <h3 className="font-black text-xl mb-6 text-slate-700 border-b border-slate-200 pb-2">{form.id ? 'Editar Producto' : 'Nuevo Producto'}</h3>
                                    <form onSubmit={handleSubmit} className="space-y-4">
                                        <input required placeholder="Nombre Camiseta" className="neu-input w-full" value={form.name} onChange={e => setForm({...form, name: e.target.value})} />
                                        
                                        <div className="flex gap-2">
                                            <button type="button" onClick={() => setForm({...form, type: 'adult'})} className={`flex-1 py-2 rounded-lg font-bold text-sm ${form.type==='adult' ? 'neu-flat text-cyan-700' : 'neu-btn text-slate-400'}`}>Adulto</button>
                                            <button type="button" onClick={() => setForm({...form, type: 'kid'})} className={`flex-1 py-2 rounded-lg font-bold text-sm ${form.type==='kid' ? 'neu-flat text-pink-500' : 'neu-btn text-slate-400'}`}>Ni√±o</button>
                                        </div>

                                        <div className="neu-pressed p-4 rounded-xl">
                                            <label className="text-xs font-bold text-slate-500 uppercase mb-2 block">Stock por Talle</label>
                                            <div className="grid grid-cols-4 gap-2">
                                                {sizesToRender.map(s => (
                                                    <div key={s}>
                                                        <label className="text-[10px] text-center block text-slate-400 font-bold">{s}</label>
                                                        <input type="number" className="neu-input w-full text-center p-1 text-sm" value={stocks[s] || 0} onChange={e => setStocks({...stocks, [s]: parseInt(e.target.value) || 0})} />
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        <div className="flex gap-2">
                                            <div className="w-2/3">
                                                <label className="text-xs font-bold text-slate-500 uppercase mb-1 block">Precio</label>
                                                <input required type="number" placeholder="$" className="neu-input w-full" value={form.price} onChange={e => setForm({...form, price: e.target.value})} />
                                            </div>
                                            <div className="w-1/3">
                                                <label className="text-xs font-bold text-slate-500 uppercase mb-1 block">% Desc.</label>
                                                <input type="number" placeholder="%" className="neu-input w-full" value={form.discount} onChange={e => setForm({...form, discount: e.target.value})} />
                                            </div>
                                        </div>
                                        {form.price && (
                                            <div className="text-right text-sm font-bold text-green-600">
                                                Precio Final: ${calculatedPrice.toLocaleString()}
                                            </div>
                                        )}
                                        
                                        <select className="neu-input w-full bg-[#e0e5ec]" value={form.league} onChange={e => setForm({...form, league: e.target.value})}>
                                            {leagues.map(l => <option key={l.id} value={l.name}>{l.name}</option>)}
                                        </select>
                                        
                                        <div>
                                            <label className="text-xs font-bold text-slate-500 uppercase mb-1 block">Fotos (URLs separadas por coma)</label>
                                            <textarea required placeholder="https://foto1.jpg, https://foto2.jpg" className="neu-input w-full h-20 text-xs" value={form.imagesStr} onChange={e => setForm({...form, imagesStr: e.target.value})}></textarea>
                                            
                                            {/* Preview de Im√°genes */}
                                            {previewImages.length > 0 && (
                                                <div className="flex gap-2 mt-2 overflow-x-auto pb-2">
                                                    {previewImages.map((img, i) => (
                                                        <div key={i} className="w-12 h-12 flex-shrink-0 rounded overflow-hidden border border-slate-300">
                                                            <img src={img} className="w-full h-full object-cover" onError={(e) => e.target.src='https://via.placeholder.com/50?text=Err'} />
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                        
                                        <div className="neu-pressed p-4 rounded-xl">
                                            <label className="text-xs font-bold text-slate-500 uppercase mb-2 block">Escudo del Equipo</label>
                                            <div className="flex gap-2 mb-3">
                                                <button type="button" onClick={() => setLogoMode('predefined')} className={`flex-1 py-1 text-xs font-bold rounded ${logoMode === 'predefined' ? 'bg-cyan-600 text-white shadow-md' : 'text-slate-500'}`}>Lista</button>
                                                <button type="button" onClick={() => setLogoMode('custom')} className={`flex-1 py-1 text-xs font-bold rounded ${logoMode === 'custom' ? 'bg-cyan-600 text-white shadow-md' : 'text-slate-500'}`}>URL</button>
                                            </div>
                                            {logoMode === 'predefined' ? (
                                                <div className="grid grid-cols-5 gap-2 max-h-40 overflow-y-auto p-1">
                                                    {PREDEFINED_TEAMS.map((url, i) => (
                                                        <div key={i} onClick={() => setForm({...form, teamLogo: url})} className={`aspect-square rounded-lg flex items-center justify-center cursor-pointer hover:bg-white p-1 transition-all border-2 ${form.teamLogo === url ? 'border-cyan-500 bg-white' : 'border-transparent'}`}>
                                                            <img src={url} className="w-full h-full object-contain" />
                                                        </div>
                                                    ))}
                                                </div>
                                            ) : (
                                                <input placeholder="Pegar URL del escudo..." className="neu-input w-full text-xs" value={form.teamLogo} onChange={e => setForm({...form, teamLogo: e.target.value})} />
                                            )}
                                        </div>
                                        
                                        <div className="flex gap-2">
                                            <button type="submit" className="neu-btn-primary flex-1 py-3 rounded-xl font-bold tracking-wide">{form.id ? 'GUARDAR CAMBIOS' : 'CREAR'}</button>
                                            {form.id && <button type="button" onClick={() => { setForm({ id: null, name: "", price: "", discount: 0, league: "Mundial", type: "adult", imagesStr: "", teamLogo: "" }); setStocks({}); }} className="neu-btn px-4 text-slate-500">Cancelar</button>}
                                        </div>
                                    </form>
                                </div>

                                <div className="lg:col-span-2 neu-flat p-6">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="font-bold text-slate-700">Cat√°logo (En la Nube)</h3>
                                        <span className="text-xs font-bold text-slate-400">{products.length} ITEMS</span>
                                    </div>
                                    <div className="max-h-[600px] overflow-y-auto space-y-3 p-2">
                                        {products.map(p => {
                                            const totalStock = p.stock ? Object.values(p.stock).reduce((a,b)=>a+b,0) : 0;
                                            const mainImg = p.images && p.images.length ? p.images[0] : p.image;
                                            return (
                                                <div key={p.id} className="neu-btn flex items-center justify-between p-3 rounded-xl cursor-default hover:transform-none">
                                                    <div className="flex items-center gap-4">
                                                        <div className="w-12 h-12 bg-white rounded-lg p-1 flex items-center justify-center shadow-inner relative">
                                                            <img src={mainImg} className="w-full h-full object-contain" />
                                                            {p.discount > 0 && <span className="absolute -top-1 -right-1 bg-red-500 text-white text-[8px] px-1 rounded-full">{p.discount}%</span>}
                                                        </div>
                                                        <div>
                                                            <div className="font-bold text-slate-800">{p.name}</div>
                                                            <div className="text-xs text-slate-500 flex items-center gap-1">
                                                                <span className={`px-1.5 rounded text-[10px] font-bold uppercase ${p.type==='kid'?'bg-pink-100 text-pink-600':'bg-blue-100 text-blue-600'}`}>{p.type==='kid'?'KID':'ADULT'}</span>
                                                                {p.teamLogo && <img src={p.teamLogo} className="w-3 h-3 object-contain"/>} {p.league}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="flex items-center gap-4">
                                                        <span className="font-bold text-slate-600">${p.price.toLocaleString()}</span>
                                                        <span className={`font-bold text-sm ${totalStock<5?'text-red-500':'text-green-600'}`}>{totalStock}u</span>
                                                        <button onClick={() => handleEditProduct(p)} className="w-8 h-8 rounded-full bg-blue-100 text-blue-500 flex items-center justify-center hover:bg-blue-500 hover:text-white transition-colors" title="Editar"><Icon name="pencil" size={16}/></button>
                                                        <button onClick={() => handleDelete(p.id)} className="w-8 h-8 rounded-full bg-red-100 text-red-500 flex items-center justify-center hover:bg-red-500 hover:text-white transition-colors"><Icon name="trash-2" size={16}/></button>
                                                    </div>
                                                </div>
                                            )
                                        })}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'orders' && (
                            <div className="neu-flat p-6">
                                <h3 className="font-bold text-slate-700 mb-6">Pedidos Recientes</h3>
                                <div className="space-y-4">
                                    {orders.length === 0 ? <p className="text-center text-slate-400 py-10">Sin pedidos.</p> : orders.sort((a,b) => b.id.localeCompare(a.id)).map(order => (
                                        <div key={order.id} className="neu-pressed bg-[#e0e5ec] p-4 rounded-xl flex flex-col md:flex-row justify-between items-center gap-4 border border-white/50">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-2 mb-2">
                                                    <span className="font-black text-cyan-600 text-lg">{order.id}</span>
                                                    <span className={`px-2 py-0.5 rounded text-[10px] font-bold uppercase ${order.status==='Pendiente'?'bg-yellow-200 text-yellow-800':'bg-green-200 text-green-800'}`}>{order.status}</span>
                                                </div>
                                                {order.buyer && (
                                                    <div className="text-xs text-slate-500 mb-3 bg-white/40 p-2 rounded-lg">
                                                        <p>üë§ <strong>{order.buyer.name}</strong></p>
                                                        <p>üì± {order.buyer.phone}</p>
                                                        <p>üìç {order.buyer.location}</p>
                                                    </div>
                                                )}
                                                <p className="text-xs text-slate-400 mb-2">{order.date}</p>
                                                <div className="text-sm text-slate-600">
                                                    {order.items.map((i,x)=><span key={x} className="block">‚Ä¢ {i.qty}x {i.name} ({i.size})</span>)}
                                                </div>
                                            </div>
                                            <div className="text-right flex flex-col items-end gap-2">
                                                <span className="text-2xl font-black text-slate-800">${order.total.toLocaleString()}</span>
                                                {order.discountPercent > 0 && <span className="text-xs text-green-600 font-bold bg-green-100 px-2 rounded">Desc. {order.discountPercent}%</span>}
                                                {order.status === 'Pendiente' && (
                                                    <button onClick={() => handleProcessOrder(order)} className="neu-btn-primary px-4 py-2 rounded-lg text-sm font-bold">Confirmar Venta</button>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'leagues' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div className="neu-flat p-6 h-fit">
                                    <h3 className="font-black text-xl mb-6 text-slate-700">Agregar Liga</h3>
                                    <form onSubmit={handleLeagueSubmit} className="space-y-4">
                                        <input required placeholder="Nombre de la Liga" className="neu-input w-full" value={leagueForm.name} onChange={e => setLeagueForm({...leagueForm, name: e.target.value})} />
                                        <input placeholder="URL Logo (Opcional)" className="neu-input w-full" value={leagueForm.logo} onChange={e => setLeagueForm({...leagueForm, logo: e.target.value})} />
                                        <button type="submit" className="neu-btn-primary w-full py-3 rounded-xl font-bold">AGREGAR LIGA</button>
                                    </form>
                                </div>
                                <div className="neu-flat p-6">
                                    <h3 className="font-black text-xl mb-6 text-slate-700">Ligas Activas</h3>
                                    <div className="space-y-3">
                                        {leagues.map(l => (
                                            <div key={l.id} className="neu-btn flex items-center justify-between p-3 rounded-xl cursor-default">
                                                <div className="flex items-center gap-3">
                                                    <img src={l.logo} className="w-8 h-8 object-contain" />
                                                    <span className="font-bold text-slate-700">{l.name}</span>
                                                </div>
                                                {l.id !== 'todas' && <button onClick={() => handleDeleteLeague(l.id)} className="text-red-400 hover:text-red-600"><Icon name="trash-2" size={18}/></button>}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'coupons' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div className="neu-flat p-6 h-fit">
                                    <h3 className="font-black text-xl mb-6 text-slate-700">Nuevo Cup√≥n</h3>
                                    <form onSubmit={handleCouponSubmit} className="space-y-4">
                                        <input required placeholder="C√≥digo (Ej: VERANO10)" className="neu-input w-full uppercase" value={couponForm.code} onChange={e => setCouponForm({...couponForm, code: e.target.value})} />
                                        <input required type="number" placeholder="% Descuento" className="neu-input w-full" value={couponForm.discount} onChange={e => setCouponForm({...couponForm, discount: e.target.value})} />
                                        <button type="submit" className="neu-btn-primary w-full py-3 rounded-xl font-bold">CREAR CUP√ìN</button>
                                    </form>
                                </div>
                                <div className="neu-flat p-6">
                                    <h3 className="font-black text-xl mb-6 text-slate-700">Cupones Vigentes</h3>
                                    <div className="space-y-3">
                                        {coupons && coupons.map(c => (
                                            <div key={c.id} className="neu-btn flex items-center justify-between p-3 rounded-xl cursor-default">
                                                <span className="font-bold text-slate-700 tracking-widest">{c.code}</span>
                                                <div className="flex items-center gap-4">
                                                    <span className="text-green-600 font-bold">{c.discount}% OFF</span>
                                                    <button onClick={() => handleDeleteCoupon(c.id)} className="text-red-400 hover:text-red-600"><Icon name="trash-2" size={18}/></button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [products, setProducts] = useState([]);
            const [orders, setOrders] = useState([]);
            const [leagues, setLeagues] = useState([]);
            const [coupons, setCoupons] = useState([]);
            const [showOnlyStock, setShowOnlyStock] = useState(false); // Estado para el filtro de stock
            
            useEffect(() => { DB.init(setProducts, setOrders, setLeagues, setCoupons); }, []);

            const [cart, setCart] = useState([]);
            const [category, setCategory] = useState("Todas");
            const [search, setSearch] = useState("");
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [isCartOpen, setIsCartOpen] = useState(false);
            const [isAdminOpen, setIsAdminOpen] = useState(false);
            const [isSidebarOpen, setIsSidebarOpen] = useState(false);
            const [isLoginModalOpen, setIsLoginModalOpen] = useState(false);

            useEffect(() => {
                const handleUrlParam = () => {
                    const params = new URLSearchParams(window.location.search);
                    const prodId = params.get('producto');
                    if (prodId && products.length > 0) {
                        const found = products.find(p => String(p.id) === prodId);
                        if (found) setSelectedProduct(found);
                    } else if (!prodId) {
                        setSelectedProduct(null);
                    }
                };

                if (products.length > 0) handleUrlParam();

                window.addEventListener('popstate', handleUrlParam);
                return () => window.removeEventListener('popstate', handleUrlParam);
            }, [products]);

            const filteredProducts = products.filter(p => {
                const matchCat = category === "Todas" || p.league === category;
                const matchSearch = p.name.toLowerCase().includes(search.toLowerCase());
                
                // Filtro de Stock
                let matchStock = true;
                if (showOnlyStock) {
                    const totalStock = p.stock ? Object.values(p.stock).reduce((a, b) => a + b, 0) : 0;
                    matchStock = totalStock > 0;
                }

                return matchCat && matchSearch && matchStock;
            });

            const handleSelectProduct = (product) => {
                setSelectedProduct(product);
                try {
                    const newUrl = `?producto=${product.id}`;
                    window.history.pushState({}, '', newUrl);
                } catch(e) {
                    console.log("URL update skipped in preview");
                }
            };

            const handleCloseModal = () => {
                setSelectedProduct(null);
                try {
                    const newUrl = window.location.pathname;
                    window.history.pushState({}, '', newUrl);
                } catch (e) {
                    console.log("URL update skipped in preview");
                }
            };

            const addToCart = (product, size) => {
                const existing = cart.find(i => i.id === product.id && i.size === size);
                const currentQty = existing ? existing.qty : 0;
                const available = product.stock && product.stock[size] ? product.stock[size] : 0;
                
                if(currentQty >= available) { alert("No hay m√°s stock disponible para este talle."); return; }

                setCart(existing ? cart.map(i => i.id===product.id && i.size===size ? {...i, qty: i.qty+1} : i) : [...cart, {...product, size, qty: 1}]);
                setIsCartOpen(true);
            };

            const updateQty = (id, size, delta) => setCart(cart.map(i => i.id===id && i.size===size ? {...i, qty: Math.max(1, i.qty+delta)} : i));
            const removeFromCart = (id, size) => setCart(cart.filter(i => !(i.id===id && i.size===size)));
            const clearCart = () => setCart([]);
            const cartTotal = cart.reduce((acc, item) => {
                const price = item.discount ? item.price * (1 - item.discount/100) : item.price;
                return acc + (price * item.qty);
            }, 0);
            const cartCount = cart.reduce((acc, item) => acc + item.qty, 0);

            const handleLogin = (pass) => { if (btoa(pass) === ADMIN_HASH) { setIsLoginModalOpen(false); setIsAdminOpen(true); } else { alert("Acceso Denegado"); } };

            return (
                <div className="min-h-screen flex flex-col relative">
                    <nav className="sticky top-0 z-40 bg-slate-900 border-b border-slate-800 shadow-2xl py-3 px-4 md:px-8 flex items-center justify-between">
                        <div className="flex items-center gap-4">
                            <button onClick={() => setIsSidebarOpen(true)} className="p-2 bg-slate-800 hover:bg-slate-700 rounded-xl text-cyan-500 transition-colors"><Icon name="menu" size={24} /></button>
                            <img src="https://i.postimg.cc/9fx1vwqg/Logo-Ay-P.png" alt="AyP Importados" className="h-10 md:h-12 w-auto object-contain drop-shadow-[0_0_10px_rgba(255,255,255,0.3)]" />
                        </div>
                        <div className="hidden md:flex flex-1 max-w-lg mx-8 relative">
                            <Icon name="search" className="absolute left-4 top-3 text-slate-500" size={18} />
                            <input type="text" placeholder="Buscar camiseta..." className="w-full bg-slate-800 border border-slate-700 rounded-2xl py-2.5 pl-11 pr-4 text-sm text-slate-200 focus:border-cyan-500 outline-none transition-all shadow-inner" value={search} onChange={e => setSearch(e.target.value)} />
                        </div>
                        <div className="flex items-center gap-4">
                            <button onClick={() => setIsLoginModalOpen(true)} className="p-2 text-slate-500 hover:text-white transition-colors" title="Admin"><Icon name="lock" size={20}/></button>
                            <button onClick={() => setIsCartOpen(true)} className="relative p-3 bg-gradient-to-br from-cyan-600 to-blue-700 text-white rounded-xl shadow-lg hover:shadow-cyan-500/50 transition-all transform hover:-translate-y-1">
                                <Icon name="shopping-cart" size={22} />
                                {cartCount > 0 && <span className="absolute -top-2 -right-2 bg-red-500 text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full font-bold border-2 border-slate-900 animate-bounce">{cartCount}</span>}
                            </button>
                        </div>
                    </nav>

                    <main className="flex-1 max-w-7xl mx-auto w-full p-4 md:p-8">
                        <div className="md:hidden mb-6 relative">
                            <Icon name="search" className="absolute left-4 top-3.5 text-slate-500" size={18} />
                            <input type="text" placeholder="Buscar..." className="neu-input w-full pl-11" value={search} onChange={e => setSearch(e.target.value)} />
                        </div>
                        
                        <div className="flex gap-4 overflow-x-auto pb-6 hide-scrollbar px-2 items-center">
                            {/* Toggle Stock Filter */}
                            <button 
                                onClick={() => setShowOnlyStock(!showOnlyStock)}
                                className={`flex items-center gap-2 whitespace-nowrap px-5 py-3 rounded-2xl text-sm font-bold transition-all border-2 ${showOnlyStock ? 'bg-green-100 text-green-700 border-green-300' : 'neu-btn text-slate-500 border-transparent'}`}
                            >
                                <Icon name="box" size={16} /> Solo En Stock
                            </button>

                            <div className="h-8 w-px bg-slate-300 mx-2"></div>

                            {leagues.map(l => (
                                <button key={l.id} onClick={() => setCategory(l.name)} className={`flex items-center gap-2 whitespace-nowrap px-5 py-3 rounded-2xl text-sm font-bold transition-all ${category === l.name ? 'neu-pressed text-cyan-600 border border-white/50' : 'neu-btn text-slate-500'}`}>
                                    {l.name !== 'Todas' && <img src={l.logo} className="w-5 h-5 object-contain" />} {l.name}
                                </button>
                            ))}
                        </div>

                        {filteredProducts.length === 0 ? (
                            <div className="text-center py-20 flex flex-col items-center">
                                <div className="w-24 h-24 neu-pressed rounded-full flex items-center justify-center mb-6 text-slate-300"><Icon name="search-x" size={40}/></div>
                                <p className="text-xl text-slate-500 font-bold">No hay camisetas aqu√≠.</p>
                                <button onClick={() => {setCategory("Todas"); setSearch(""); setShowOnlyStock(false);}} className="mt-6 text-cyan-600 font-bold hover:underline">Ver todo</button>
                            </div>
                        ) : (
                            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-8">
                                {filteredProducts.map(product => (
                                    <div key={product.id} onClick={() => handleSelectProduct(product)} className="cursor-pointer">
                                        <ProductCard product={product} onAdd={() => handleSelectProduct(product)} leagues={leagues} />
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>

                    <footer className="text-center py-8 text-slate-400 text-sm font-bold"><p>AyP Importados ¬© 2026</p></footer>

                    <Sidebar isOpen={isSidebarOpen} onClose={() => setIsSidebarOpen(false)} onSelectCategory={setCategory} activeCategory={category} leagues={leagues} />
                    <ProductModal product={selectedProduct} isOpen={!!selectedProduct} onClose={handleCloseModal} onAddToCart={addToCart} leagues={leagues} />
                    <CartSidebar isOpen={isCartOpen} onClose={() => setIsCartOpen(false)} cart={cart} updateQty={updateQty} remove={removeFromCart} total={cartTotal} onCreateOrder={clearCart} products={products} coupons={coupons} />
                    <LoginModal isOpen={isLoginModalOpen} onClose={() => setIsLoginModalOpen(false)} onLogin={handleLogin} />
                    <AdminPanel isOpen={isAdminOpen} onClose={() => setIsAdminOpen(false)} products={products} orders={orders} leagues={leagues} coupons={coupons} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
