<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AyP Importados</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        @keyframes blob { 0% { transform: translate(0px, 0px) scale(1); } 33% { transform: translate(30px, -50px) scale(1.1); } 66% { transform: translate(-20px, 20px) scale(0.9); } 100% { transform: translate(0px, 0px) scale(1); } }
        .animate-blob { animation: blob 10s infinite; }
        .animation-delay-2000 { animation-delay: 2s; }
        .animation-delay-4000 { animation-delay: 4s; }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .animate-marquee { display: inline-block; white-space: nowrap; animation: marquee 20s linear infinite; }
        .logo-wrapper { position: relative; overflow: hidden; border-radius: 12px; padding: 5px; }
        .logo-img { transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); filter: drop-shadow(0 0 0 rgba(0,0,0,0)); }
        .logo-wrapper:hover .logo-img { filter: drop-shadow(-6px -6px 8px rgba(0, 100, 255, 0.6)) drop-shadow(0px 0px 8px rgba(255, 255, 255, 0.8)) drop-shadow(6px 6px 8px rgba(255, 0, 50, 0.6)); transform: scale(1.1) rotate(2deg); }
        .glass-select { appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23334155' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.75rem center; background-repeat: no-repeat; background-size: 1.2em 1.2em; padding-right: 2.5rem; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Rank Styles */
        .rank-1 { background: linear-gradient(135deg, #FFD700 0%, #FDB931 100%); color: #000; border: 2px solid #FFF7CC; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3); }
        .rank-2 { background: linear-gradient(135deg, #E0E0E0 0%, #BDBDBD 100%); color: #000; border: 2px solid #FFF; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        .rank-3 { background: linear-gradient(135deg, #CD7F32 0%, #A0522D 100%); color: #FFF; border: 2px solid #FFDAB9; box-shadow: 0 4px 15px rgba(160, 82, 45, 0.3); }
        .rank-other { background: white; color: #1e293b; border: 1px solid #e2e8f0; }

        @media print { body * { visibility: hidden; } .ticket-modal, .ticket-modal * { visibility: visible; } .ticket-modal { position: absolute; left: 0; top: 0; width: 100%; background: white !important; color: black !important; } .no-print { display: none !important; } }
    </style>

    <!-- FIREBASE INITIALIZATION MODULE -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, query, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAnrHBpTZTZnnzzdqMWiaKo-UQGhScxE2Y",
            authDomain: "ayp-camisetas-f1348.firebaseapp.com",
            projectId: "ayp-camisetas-f1348",
            storageBucket: "ayp-camisetas-f1348.firebasestorage.app",
            messagingSenderId: "135355835055",
            appId: "1:135355835055:web:29a768153319904a3d2a5a",
            measurementId: "G-PM6M1QV0NN"
        };
        
        const configToUse = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : firebaseConfig;
        
        const app = initializeApp(configToUse);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'ayp-camisetas-prod-v2';

        window.firebase = { 
            auth, db, signInAnonymously, onAuthStateChanged, signInWithCustomToken,
            collection, doc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, query, getDocs,
            APP_ID,
            initialToken: typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null
        };
    </script>
</head>
<body class="bg-slate-50 text-slate-900 transition-colors duration-700 font-sans">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        
        // --- √çCONOS SVG ---
        const IconBase = ({ children, size = 24, className = "" }) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>);
        const ShoppingCart = (p) => <IconBase {...p}><circle cx="8" cy="21" r="1" /><circle cx="19" cy="21" r="1" /><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12" /></IconBase>;
        const Search = (p) => <IconBase {...p}><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /></IconBase>;
        const Filter = (p) => <IconBase {...p}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" /></IconBase>;
        const X = (p) => <IconBase {...p}><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></IconBase>;
        const Trash2 = (p) => <IconBase {...p}><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></IconBase>;
        const MessageCircle = (p) => <IconBase {...p}><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" /></IconBase>;
        const ChevronLeft = (p) => <IconBase {...p}><polyline points="15 18 9 12 15 6" /></IconBase>;
        const ChevronRight = (p) => <IconBase {...p}><polyline points="9 18 15 12 9 6" /></IconBase>;
        const Trophy = (p) => <IconBase {...p}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" /><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" /><path d="M4 22h16" /><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" /><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" /><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" /></IconBase>;
        const History = (p) => <IconBase {...p}><path d="M3 3v5h5" /><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8" /></IconBase>;
        const Tag = (p) => <IconBase {...p}><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z" /><line x1="7" y1="7" x2="7.01" y2="7" /></IconBase>;
        const Lock = (p) => <IconBase {...p}><rect x="3" y="11" width="18" height="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" /></IconBase>;
        const CheckCircle = (p) => <IconBase {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></IconBase>;
        const AlertTriangle = (p) => <IconBase {...p}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><line x1="12" y1="9" x2="12" y2="13" /><line x1="12" y1="17" x2="12.01" y2="17" /></IconBase>;
        const MenuIcon = (p) => <IconBase {...p}><line x1="4" x2="20" y1="12" y2="12" /><line x1="4" x2="20" y1="6" y2="6" /><line x1="4" x2="20" y1="18" y2="18" /></IconBase>;
        const Plus = (p) => <IconBase {...p}><path d="M5 12h14" /><path d="M12 5v14" /></IconBase>;
        const Download = (p) => <IconBase {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" y1="15" x2="12" y2="3" /></IconBase>;
        const Edit = (p) => <IconBase {...p}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" /></IconBase>;
        const Share2 = (p) => <IconBase {...p}><circle cx="18" cy="5" r="3" /><circle cx="6" cy="12" r="3" /><circle cx="18" cy="19" r="3" /><line x1="8.59" y1="13.51" x2="15.42" y2="17.49" /><line x1="15.41" y1="6.51" x2="8.59" y2="10.49" /></IconBase>;
        const Phone = (p) => <IconBase {...p}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" /></IconBase>;
        const Instagram = (p) => <IconBase {...p}><rect x="2" y="2" width="20" height="20" rx="5" ry="5" /><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" /><line x1="17.5" y1="6.5" x2="17.51" y2="6.5" /></IconBase>;
        const LinkIcon = (p) => <IconBase {...p}><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" /><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" /></IconBase>;
        const Star = (p) => <IconBase {...p}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" /></IconBase>;
        const Heart = (p) => <IconBase {...p}><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" /></IconBase>;
        const Globe = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10" /><line x1="2" y1="12" x2="22" y2="12" /><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10z" /></IconBase>;
        const Truck = (p) => <IconBase {...p}><rect x="1" y="3" width="15" height="13" /><polygon points="16 8 20 8 23 11 23 16 16 16 16 8" /><circle cx="5.5" cy="18.5" r="2.5" /><circle cx="18.5" cy="18.5" r="2.5" /></IconBase>;
        const Gift = (p) => <IconBase {...p}><polyline points="20 12 20 22 4 22 4 12" /><rect x="2" y="7" width="20" height="5" /><line x1="12" y1="22" x2="12" y2="7" /><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z" /><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z" /></IconBase>;
        const ArrowLeft = (p) => <IconBase {...p}><line x1="19" y1="12" x2="5" y2="12" /><polyline points="12 19 5 12 12 5" /></IconBase>;
        const Zap = (p) => <IconBase {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" /></IconBase>;
        const Layers = (p) => <IconBase {...p}><polygon points="12 2 2 7 12 12 22 7 12 2" /><polyline points="2 17 12 22 22 17" /><polyline points="2 12 12 17 22 12" /></IconBase>;

        const ICON_MAP = { 'link': LinkIcon, 'whatsapp': Phone, 'instagram': Instagram, 'star': Star, 'heart': Heart, 'globe': Globe, 'truck': Truck, 'gift': Gift };

        // --- CONSTANTES ---
        const ADMIN_HASH = "MDYyNzA4";
        const INITIAL_MARQUEE = "‚öΩ ENV√çOS GRATIS A TODO EL PA√çS EN COMPRAS SUPERIORES A $150.000 ‚öΩ  üî• 3 CUOTAS SIN INTER√âS üî•";
        
        // Categor√≠as iniciales
        const INITIAL_CATEGORIES = [
            { id: 1, name: "Premier League", image: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgkSAf6I2sP5AuBQq1YxsDh7Dg167gncu5PZwUvDVMXed1QQRyl9JQygpr_Jp5OJZdTrqUbjZWxUpu42nblIK1bFKpCf2t-XoyRJf4MMCVYRA24wAR6iQx78HOtwRSAazGguxHSZWJWmN0/s1600/PL.png" },
            { id: 2, name: "La Liga", image: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEirXlLZ6JGoNTRW4xbsozgyfWK6Px4XVkQ-AOxSeoSOjvB6Uma4rYshen8djk6uIwkgD_KsHJl9d7WD6jCcPvLLPa6DtB25ok9qszZ6EoYPcYL_FiOOjsVQVWrKQsJTy9dT6XGFYOCj1Q412AVMNvXn40SCvw4Q_34Nhu33-XhhlH5P3GMMzle-fBSFg6A/s16000/LaLiga.png" },
            { id: 3, name: "Argentina LPF", image: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi-tqx9482e9g6j0VIodmDN28aglSmHZFOOv2BTiX_A0CABdPrJWS3_WgWQm4cEIqoJmfTy5a0rsGb9b88QzVp-kJf0WYirNZMt1hQFAUi0M_-I1O7T93BmebBI3GfpJf4lGv42vCOar-c/d/LPF.png" },
            { id: 4, name: "World Cup", image: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjnalN74so4om-iSDLjMukAB_NAFeQvLMEaCBlArWfL_hNClYYZBLpcIuzODwwEvy41KLxlJ_oQhNk1FOPlYq4Gx4Vdhc_DyqAxDLA9QaLiHtSm3yb3qNf8tgmPiGz0CQQAikiOEw4kuiyq082XjcpTngo7Lb5eo2omTxGOvMnyAaOJiFKS9hHIngvux_Q/s16000/2026%20FIFA%20World%20Cup512x.png" },
            { id: 5, name: "Serie A", image: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhMhcOk43mj3-jSTxhIOK0a5HNGBFcXWfojKWTr0nxlq7H9j9azR_WSXunp7wIG46Oijp1s0Qb9qmtgTkqR686OOPj1PFExA7DXk9E6hO8PAlmFkEYW5hHcsaveO-dWhw4biJgJSBCPVjE5bmcFooTbOXthGNRyypArGLNg-1ITKX8AQEUVsAUGKAWq/s16000/Lega%20Serie%20A%20TIM.png" },
            { id: 6, name: "Brasileirao", image: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjonZaPEY15CvlPFdoSBYmO3yJHjokO9W7aIdCT2wfCPtVU1HJ-XBy01iCEmeA2k0wvl2iFa7cmsBsiSAa1uaV9RAeDPUDSftQGDiYPsi4hUZ1ZpEGA3dnlyjafaXQvD314fmWMNgwqy3VJH-hCsLyJk47jNJ47DxHFsdnG0VhBeluMaJ3e_A_xTxsuA8Q/s16000/Brasileirao%20Betano.png" },
            { id: 7, name: "Ligue 1", image: "https://upload.wikimedia.org/wikipedia/commons/4/49/Ligue1_Uber_Eats_logo.png" }
        ];
        
        const INITIAL_CONTACTS = [
            { id: 1, label: "WhatsApp Mayorista", url: "https://wa.me/5493515604303", type: "whatsapp" },
            { id: 2, label: "Instagram", url: "https://www.instagram.com/ayp_importados/?hl=es", type: "instagram" }
        ];

        // Definiciones de Talles
        const SIZES_ADULT = ["XS", "S", "M", "L", "XL", "XXL", "3XL"];
        const SIZES_KIDS = ["8", "10", "12", "14"];

        // Productos Iniciales (con target: 'adult' por defecto)
        const INITIAL_PRODUCTS = [
            { id: 1, name: "Argentina 2025", sales: 120, price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Campe√≥n", league: "World Cup", team: "Argentina", type: "Actual", version: "Fan", category: "Selecci√≥n", target: "adult", stock: { "XS": 1, "S": 1, "M": 1, "L": 1, "XL": 1, "XXL": 1, "3XL": 1 }, images: ["https://i.postimg.cc/bNNfKWrw/a-RGENTINA-2025.webp"], tags: ["2025", "Campe√≥n", "Celeste", "Blanco"], description: "Camiseta oficial de la Selecci√≥n Argentina para la temporada 2025. Tecnolog√≠a de absorci√≥n de humedad AEROREADY.", colors: { primary: "#7dd3fc", secondary: "#ffffff" } },
            { id: 2, name: "Alemania 2026", sales: 45, price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "", league: "World Cup", team: "Alemania", type: "Actual", version: "Fan", category: "Selecci√≥n", target: "adult", stock: { "XS": 1, "S": 1, "M": 1, "L": 1, "XL": 1, "XXL": 1, "3XL": 1 }, images: ["https://i.postimg.cc/mZSGpBLh/Alemania-2026.webp"], tags: ["2026", "Blanco"], description: "Camiseta local de Alemania para el Mundial 2026. Dise√±o cl√°sico en blanco y negro.", colors: { primary: "#ffffff", secondary: "#000000" } },
            { id: 3, name: "Boca Retro 1998", sales: 85, price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Retro", league: "Argentina LPF", team: "Boca Juniors", type: "Retro", version: "Normal", category: "Club", target: "adult", stock: { "XS": 1, "S": 1, "M": 1, "L": 1, "XL": 1, "XXL": 1, "3XL": 1 }, images: ["https://i.postimg.cc/wxkd4gqJ/Boca-retro-1998.webp"], tags: ["Retro", "1998", "Azul", "Amarillo"], description: "Edici√≥n retro hist√≥rica de Boca Juniors 1998. Cuello polo y franja amarilla tradicional.", colors: { primary: "#1e3a8a", secondary: "#eab308" } },
            { id: 4, name: "Boca Titular 2025", sales: 95, price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Nuevo", league: "Argentina LPF", team: "Boca Juniors", type: "Actual", version: "Fan", category: "Club", target: "adult", stock: { "XS": 1, "S": 1, "M": 1, "L": 1, "XL": 1, "XXL": 1, "3XL": 1 }, images: ["https://i.postimg.cc/QNqrYh87/Boca-titular-2025.webp"], tags: ["2025", "Azul", "Oro"], description: "Camiseta titular de Boca Juniors temporada 2025.", colors: { primary: "#1d4ed8", secondary: "#eab308" } },
            { id: 5, name: "Chelsea 2026", sales: 30, price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Player Version", league: "Premier League", team: "Chelsea", type: "Actual", version: "Player", category: "Club", target: "adult", stock: { "XS": 1, "S": 1, "M": 1, "L": 1, "XL": 1, "XXL": 1, "3XL": 1 }, images: ["https://i.postimg.cc/nccf6grX/CHELSEA-2026.avif"], tags: ["2026", "Blues", "Azul"], description: "Camiseta Chelsea 2026 versi√≥n jugador. Corte ajustado y tecnolog√≠a de ventilaci√≥n avanzada.", colors: { primary: "#2563eb", secondary: "#1e40af" } },
            { id: 6, name: "Liverpool Suplente", sales: 25, price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Suplente", league: "Premier League", team: "Liverpool", type: "Actual", version: "Fan", category: "Club", target: "adult", stock: { "XS": 1, "S": 1, "M": 1, "L": 1, "XL": 1, "XXL": 1, "3XL": 1 }, images: ["https://i.postimg.cc/L66Frw5q/LIVERPOOL-SUPLENTE.webp"], tags: ["Suplente", "Verde"], description: "Segunda equipaci√≥n del Liverpool. Dise√±o moderno y urbano.", colors: { primary: "#16a34a", secondary: "#ffffff" } },
            { id: 7, name: "Milan Titular", sales: 55, price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Cl√°sico", league: "Serie A", team: "Milan", type: "Actual", version: "Fan", category: "Club", target: "adult", stock: { "XS": 1, "S": 1, "M": 1, "L": 1, "XL": 1, "XXL": 1, "3XL": 1 }, images: ["https://i.postimg.cc/L66Frw5Y/MILAN-TITULAR.webp"], tags: ["Rojo", "Negro"], description: "Camiseta cl√°sica a rayas rojas y negras del AC Milan.", colors: { primary: "#dc2626", secondary: "#000000" } },
            { id: 8, name: "Real Madrid Tercera", sales: 70, price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Tercera", league: "La Liga", team: "Real Madrid", type: "Actual", version: "Fan", category: "Club", target: "adult", stock: { "XS": 1, "S": 1, "M": 1, "L": 1, "XL": 1, "XXL": 1, "3XL": 1 }, images: ["https://i.postimg.cc/kXXPkzGt/Real-Madrid-tercera.webp"], tags: ["Tercera", "Gris"], description: "Tercera equipaci√≥n del Real Madrid. Elegancia y estilo.", colors: { primary: "#1f2937", secondary: "#eab308" } },
            { id: 9, name: "River 2025", sales: 90, price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Nuevo", league: "Argentina LPF", team: "River Plate", type: "Actual", version: "Fan", category: "Club", target: "adult", stock: { "XS": 1, "S": 1, "M": 1, "L": 1, "XL": 1, "XXL": 1, "3XL": 1 }, images: ["https://i.postimg.cc/CLLpWX58/River-2025.jpg"], tags: ["2025", "Blanco", "Rojo"], description: "Camiseta titular de River Plate 2025. La banda roja tradicional.", colors: { primary: "#ffffff", secondary: "#dc2626" } },
            { id: 10, name: "Corinthians Suplente", sales: 15, price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Suplente", league: "Brasileirao", team: "Corinthians", type: "Actual", version: "Fan", category: "Club", target: "adult", stock: { "XS": 1, "S": 1, "M": 1, "L": 1, "XL": 1, "XXL": 1, "3XL": 1 }, images: ["https://i.postimg.cc/GhhnZVtG/SUPLENTE-CORINTHIANS.webp"], tags: ["Suplente", "Negro"], description: "Camiseta negra alternativa del Timao.", colors: { primary: "#000000", secondary: "#ffffff" } },
            { id: 11, name: "PSG Suplente", sales: 40, price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Suplente", league: "Ligue 1", team: "PSG", type: "Actual", version: "Fan", category: "Club", target: "adult", stock: { "XS": 1, "S": 1, "M": 1, "L": 1, "XL": 1, "XXL": 1, "3XL": 1 }, images: ["https://i.postimg.cc/3JJQPVNp/SUPLENTE-PSG.jpg"], tags: ["Suplente", "Azul"], description: "Camiseta suplente del Paris Saint-Germain.", colors: { primary: "#1e3a8a", secondary: "#dc2626" } },
            { id: 12, name: "Barcelona Tercera", sales: 65, price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Tercera", league: "La Liga", team: "Barcelona", type: "Actual", version: "Fan", category: "Club", target: "adult", stock: { "XS": 1, "S": 1, "M": 1, "L": 1, "XL": 1, "XXL": 1, "3XL": 1 }, images: ["https://i.postimg.cc/RVVxjyhR/TERCERA-BARCELONA.webp"], tags: ["Tercera", "Verde"], description: "Tercera camiseta del FC Barcelona. Dise√±o vibrante.", colors: { primary: "#14b8a6", secondary: "#1e3a8a" } }
        ];

        // --- COMPONENTES AUXILIARES ---
        const Badge = ({ children, color = "blue" }) => {
            const colors = { blue: "bg-blue-100 text-blue-800 border-blue-200", purple: "bg-purple-100 text-purple-800 border-purple-200", green: "bg-green-100 text-green-800 border-green-200", amber: "bg-amber-100 text-amber-800 border-amber-200", red: "bg-red-100 text-red-800 border-red-200", gray: "bg-slate-100 text-slate-800 border-slate-200", pink: "bg-pink-100 text-pink-800 border-pink-200" };
            return <span className={`px-2 py-0.5 rounded-full text-xs font-medium border ${colors[color]}`}>{children}</span>;
        };

        const ImageSlider = ({ images, alt }) => {
            const [current, setCurrent] = useState(0);
            if (!images || images.length === 0) return <div className="w-full h-full flex items-center justify-center text-slate-400">Sin Imagen</div>;
            return (
                <div className="relative w-full h-full group">
                    <img src={images[current]} alt={alt} className="w-full h-full object-contain transition-transform duration-500" />
                    {images.length > 1 && (<><button onClick={(e)=>{e.stopPropagation();setCurrent((c)=>(c-1+images.length)%images.length)}} className="absolute left-2 top-1/2 -translate-y-1/2 bg-white/50 text-slate-900 p-2 rounded-full hover:bg-white z-20 shadow-md"><ChevronLeft size={20}/></button><button onClick={(e)=>{e.stopPropagation();setCurrent((c)=>(c+1)%images.length)}} className="absolute right-2 top-1/2 -translate-y-1/2 bg-white/50 text-slate-900 p-2 rounded-full hover:bg-white z-20 shadow-md"><ChevronRight size={20}/></button><div className="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2 z-20">{images.map((_, i) => (<div key={i} className={`w-2 h-2 rounded-full ${i === current ? 'bg-slate-900' : 'bg-slate-300'}`} />))}</div></>)}
                </div>
            );
        };

        // ... (BuyerForm, TicketView, LoginModal, Sidebar, OnlineUsers sin cambios mayores, solo Sidebar referenciado) ...
        const BuyerForm = ({ onSubmit, onClose }) => {
            const [formData, setFormData] = useState({ name: "", email: "", whatsapp: "", country: "", province: "" });
            const handleSubmit = (e) => {
                e.preventDefault();
                if (formData.name && formData.whatsapp && formData.country && formData.province) { onSubmit(formData); }
                else { alert("Por favor completa todos los campos obligatorios (*)."); }
            };
            return (
                <div className="fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md">
                    <div className="bg-white p-6 rounded-2xl w-full max-w-md shadow-2xl relative">
                        <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 hover:text-slate-900"><X size={20}/></button>
                        <h3 className="text-xl font-bold text-slate-900 mb-6 text-center">Datos del Comprador</h3>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <input required placeholder="Nombre Completo *" className="w-full bg-slate-50 border border-slate-200 rounded-lg p-3 text-slate-900 focus:border-cyan-500 outline-none" value={formData.name} onChange={e=>setFormData({...formData, name: e.target.value})} />
                            <input type="email" placeholder="Correo Electr√≥nico" className="w-full bg-slate-50 border border-slate-200 rounded-lg p-3 text-slate-900 focus:border-cyan-500 outline-none" value={formData.email} onChange={e=>setFormData({...formData, email: e.target.value})} />
                            <input required placeholder="WhatsApp (con c√≥digo de pa√≠s) *" className="w-full bg-slate-50 border border-slate-200 rounded-lg p-3 text-slate-900 focus:border-cyan-500 outline-none" value={formData.whatsapp} onChange={e=>setFormData({...formData, whatsapp: e.target.value})} />
                            <div className="grid grid-cols-2 gap-4">
                                <input required placeholder="Pa√≠s *" className="w-full bg-slate-50 border border-slate-200 rounded-lg p-3 text-slate-900 focus:border-cyan-500 outline-none" value={formData.country} onChange={e=>setFormData({...formData, country: e.target.value})} />
                                <input required placeholder="Provincia/Estado *" className="w-full bg-slate-50 border border-slate-200 rounded-lg p-3 text-slate-900 focus:border-cyan-500 outline-none" value={formData.province} onChange={e=>setFormData({...formData, province: e.target.value})} />
                            </div>
                            <button type="submit" className="w-full py-3 bg-green-600 hover:bg-green-500 text-white font-bold rounded-xl transition-colors">Continuar con el Pedido</button>
                        </form>
                    </div>
                </div>
            );
        };

        const TicketView = ({ order, onClose }) => {
            if (!order) return null;
            const handleWhatsApp = () => {
                let message = `Hola, mi n√∫mero de orden es #${order.id}. Quiero confirmar mi compra. ‚öΩ\n\n`;
                message += `*DATOS DEL COMPRADOR:*\nNombre: ${order.buyer.name}\nWhatsApp: ${order.buyer.whatsapp}\nEmail: ${order.buyer.email || 'N/A'}\nUbicaci√≥n: ${order.buyer.province}, ${order.buyer.country}\n\n`;
                message += `*PEDIDO:*\n`;
                order.items.forEach(item => { message += `- ${item.name} (${item.version || 'Normal'}) - Talle ${item.size} x${item.qty}\n`; });
                message += `\n*TOTAL A PAGAR: $${order.finalTotal.toLocaleString()}*`;
                window.open(`https://wa.me/5493515604303?text=${encodeURIComponent(message)}`, '_blank');
            };

            const handleDownloadPDF = () => {
                const doc = new jspdf.jsPDF();
                doc.setFontSize(22); doc.setFont("helvetica", "bold"); doc.text("AyP Importados", 105, 20, null, null, "center");
                doc.setFontSize(12); doc.setFont("helvetica", "normal"); doc.text("Comprobante de Orden de Compra", 105, 28, null, null, "center");
                doc.setLineWidth(0.5); doc.line(20, 35, 190, 35);
                doc.setFontSize(10); doc.text(`Orden #: ${order.id}`, 20, 45); doc.text(`Fecha: ${new Date(order.date).toLocaleDateString()} ${new Date(order.date).toLocaleTimeString()}`, 190, 45, null, null, "right");
                doc.setFont("helvetica", "bold"); doc.text("Datos del Comprador:", 20, 55);
                doc.setFont("helvetica", "normal"); doc.text(`Nombre: ${order.buyer.name}`, 20, 62); doc.text(`WhatsApp: ${order.buyer.whatsapp}`, 20, 68); doc.text(`Email: ${order.buyer.email || 'N/A'}`, 110, 62); doc.text(`Ubicaci√≥n: ${order.buyer.province}, ${order.buyer.country}`, 110, 68);
                let y = 85; doc.setFont("helvetica", "bold"); doc.text("Producto", 20, y); doc.text("Cant.", 130, y, null, null, "center"); doc.text("Precio Unit.", 160, y, null, null, "right"); doc.text("Total", 190, y, null, null, "right"); doc.line(20, y + 2, 190, y + 2);
                y += 10; doc.setFont("helvetica", "normal");
                order.items.forEach((item) => {
                    const productName = `${item.name} (${item.version || 'Normal'}) - Talle ${item.size}`;
                    const splitTitle = doc.splitTextToSize(productName, 100);
                    doc.text(splitTitle, 20, y); doc.text(`${item.qty}`, 130, y, null, null, "center"); doc.text(`$${item.price.toLocaleString()}`, 160, y, null, null, "right"); doc.text(`$${(item.price * item.qty).toLocaleString()}`, 190, y, null, null, "right");
                    y += (splitTitle.length * 5) + 5;
                });
                y += 5; doc.line(20, y, 190, y); y += 10;
                if (order.discount > 0) { doc.text(`Subtotal:`, 160, y, null, null, "right"); doc.text(`$${order.total.toLocaleString()}`, 190, y, null, null, "right"); y += 8; doc.text(`Descuento (${order.discount}%):`, 160, y, null, null, "right"); doc.text(`-$${(order.total - order.finalTotal).toLocaleString()}`, 190, y, null, null, "right"); y += 8; }
                doc.setFont("helvetica", "bold"); doc.setFontSize(14); doc.text(`TOTAL:`, 160, y, null, null, "right"); doc.text(`$${order.finalTotal.toLocaleString()}`, 190, y, null, null, "right");
                doc.setFontSize(10); doc.setFont("helvetica", "normal"); doc.text("Gracias por tu compra en AyP Importados!", 105, 280, null, null, "center");
                doc.save(`AyP_Orden_${order.id}.pdf`);
            };

            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md">
                    <div className="ticket-modal bg-white text-slate-900 w-full max-w-md rounded-lg shadow-2xl overflow-hidden relative font-mono text-sm">
                        <div className="bg-slate-900 text-white p-4 text-center"><h2 className="text-xl font-bold uppercase tracking-widest">AyP Importados</h2><p className="text-xs text-slate-400">Comprobante de Venta</p></div>
                        <div className="p-6 bg-white">
                            <div className="border-b-2 border-dashed border-slate-300 pb-4 mb-4"><p className="flex justify-between"><span>FECHA:</span> <span>{new Date(order.date).toLocaleDateString()}</span></p><p className="flex justify-between"><span>HORA:</span> <span>{new Date(order.date).toLocaleTimeString()}</span></p><p className="flex justify-between font-bold text-lg"><span>ORDEN #:</span> <span>{order.id}</span></p></div>
                            <div className="border-b-2 border-dashed border-slate-300 pb-4 mb-4 text-sm bg-slate-50 p-3 rounded"><p className="font-bold mb-2 uppercase border-b border-slate-200 pb-1">Datos del Comprador:</p><p><span className="font-semibold">Nombre:</span> {order.buyer.name}</p><p><span className="font-semibold">WhatsApp:</span> {order.buyer.whatsapp}</p>{order.buyer.email && <p><span className="font-semibold">Email:</span> {order.buyer.email}</p>}<p><span className="font-semibold">Ubicaci√≥n:</span> {order.buyer.province}, {order.buyer.country}</p></div>
                            <div className="space-y-4 mb-6">{order.items.map((item, i) => (<div key={i} className="flex flex-col border-b border-slate-100 pb-2 last:border-0"><div className="flex justify-between items-start"><span className="font-bold flex-1">{item.name} <span className="text-xs font-normal text-slate-500">({item.version || 'Normal'})</span></span><span className="font-bold">${(item.price * item.qty).toLocaleString()}</span></div><div className="text-xs text-slate-500 flex justify-between"><span>Talle: {item.size} | Cantidad: {item.qty}</span></div></div>))}</div>
                            <div className="border-t-2 border-dashed border-slate-300 pt-4 mb-6">{order.discount > 0 && <div className="flex justify-between text-sm text-slate-500 mb-2"><span>Subtotal</span><span>${order.total.toLocaleString()}</span></div>}{order.discount > 0 && <div className="flex justify-between text-sm text-green-600 mb-2"><span>Descuento ({order.discount}%)</span><span>-${(order.total - order.finalTotal).toLocaleString()}</span></div>}<div className="flex justify-between text-xl font-black mt-2"><span>TOTAL</span><span>${order.finalTotal.toLocaleString()}</span></div></div>
                            <div className="space-y-2 no-print"><button onClick={handleWhatsApp} className="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded font-bold flex items-center justify-center gap-2 uppercase transition-colors"><MessageCircle size={18} /> Seguir compra por WhatsApp</button><button onClick={handleDownloadPDF} className="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded font-bold flex items-center justify-center gap-2 uppercase transition-colors"><CheckCircle size={18} /> Descargar PDF</button><button onClick={onClose} className="w-full bg-slate-200 hover:bg-slate-300 text-slate-900 py-3 rounded font-bold flex items-center justify-center gap-2 uppercase transition-colors">Cerrar</button></div>
                        </div>
                    </div>
                </div>
            );
        };

        const LoginModal = ({ isOpen, onClose, onLogin }) => {
            const [password, setPassword] = useState("");
            if (!isOpen) return null;
            const handleSubmit = (e) => { e.preventDefault(); onLogin(password); setPassword(""); };
            return (
                <div className="fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md">
                    <div className="bg-white p-6 rounded-2xl w-full max-w-sm shadow-2xl relative">
                        <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 hover:text-slate-900"><X size={20}/></button>
                        <div className="flex flex-col items-center mb-6"><div className="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mb-3"><AlertTriangle className="text-red-500" size={24} /></div><h3 className="text-xl font-bold text-slate-900 text-center">Acceso Restringido</h3></div>
                        <form onSubmit={handleSubmit} className="space-y-4"><div><label className="block text-xs font-bold text-slate-500 uppercase mb-1">Contrase√±a</label><input autoFocus type="password" className="w-full bg-slate-50 border border-slate-200 rounded-lg p-3 text-slate-900 focus:border-cyan-500 outline-none" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value={password} onChange={(e) => setPassword(e.target.value)} /></div><button type="submit" className="w-full py-3 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-xl">Ingresar</button></form>
                    </div>
                </div>
            );
        };

        const Sidebar = ({ isOpen, onClose, categories, onSelectCategory, activeCategory, contacts, setView }) => (
            <>
                <div className={`fixed inset-0 bg-black/60 backdrop-blur-sm z-50 transition-opacity duration-300 ${isOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'}`} onClick={onClose} />
                <div className={`fixed inset-y-0 left-0 w-72 bg-white border-r border-slate-200 z-50 transform transition-transform duration-300 shadow-2xl flex flex-col ${isOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                    <div className="p-6 flex justify-between items-center border-b border-slate-100"><h2 className="text-xl font-bold text-slate-900">Men√∫</h2><button onClick={onClose}><X className="text-slate-500 hover:text-slate-900"/></button></div>
                    <div className="flex-1 overflow-y-auto p-4 space-y-2">
                        <button onClick={()=>{setView('home'); onSelectCategory('Todas');onClose()}} className={`w-full text-left p-3 rounded-xl flex items-center gap-3 ${activeCategory==='Todas'?'bg-cyan-600 text-white':'text-slate-600 hover:bg-slate-50'}`}><Trophy size={18}/> Cat√°logo Completo</button>
                        <button onClick={()=>{setView('popular'); onClose()}} className={`w-full text-left p-3 rounded-xl flex items-center gap-3 text-amber-500 hover:bg-slate-50`}><Star size={18}/> M√°s Populares</button>
                        <div className="py-2 border-t border-slate-100 mt-2"><span className="text-xs font-bold text-slate-400 px-3 uppercase">Ligas</span></div>
                        {categories.map(c => (
                            <button key={c.id} onClick={()=>{setView('home'); onSelectCategory(c.name);onClose()}} className={`w-full text-left p-3 rounded-xl flex items-center gap-3 border border-transparent ${activeCategory===c.name?'bg-slate-100 border-cyan-500 text-slate-900':'text-slate-600 hover:bg-slate-50'}`}>
                                <img src={c.image} className="w-6 h-6 object-contain" /> {c.name}
                            </button>
                        ))}
                    </div>
                    <div className="p-4 border-t border-slate-100 space-y-2">
                        <h3 className="text-xs font-bold text-slate-400 uppercase mb-2">Contacto</h3>
                        {contacts.map(c => {
                            const IconComponent = ICON_MAP[c.type] || LinkIcon;
                            return (
                                <a key={c.id} href={c.url} target="_blank" className="flex items-center gap-3 p-3 rounded-xl bg-slate-50 hover:bg-slate-100 text-slate-600 transition group">
                                    <IconComponent size={18} className={c.type === 'instagram' ? 'text-pink-500' : c.type === 'whatsapp' ? 'text-green-500' : 'text-blue-500'} />
                                    <span className="flex-1">{c.label}</span>
                                    {c.type === 'instagram' && <span className="text-[10px] bg-blue-600 px-2 py-0.5 rounded text-white group-hover:bg-blue-500">Seguir</span>}
                                </a>
                            );
                        })}
                    </div>
                </div>
            </>
        );

        const OnlineUsers = ({ user }) => {
            const [count, setCount] = useState(1);

            useEffect(() => {
                if (!user) return;
                const { db, APP_ID, collection, doc, setDoc, deleteDoc, onSnapshot } = window.firebase;
                
                const presenceRef = collection(db, 'artifacts', APP_ID, 'public', 'data', 'presence');
                const myDoc = doc(presenceRef, user.uid);

                const beat = () => {
                    setDoc(myDoc, { last_seen: Date.now() }).catch(err => console.warn("Presence err:", err));
                };

                beat();
                const intervalId = setInterval(beat, 5000);

                const unsub = onSnapshot(presenceRef, (snapshot) => {
                    const now = Date.now();
                    const active = snapshot.docs.filter(d => {
                        const data = d.data();
                        return data.last_seen && (now - data.last_seen < 15000);
                    }).length;
                    setCount(Math.max(1, active));
                });

                return () => {
                    clearInterval(intervalId);
                    unsub();
                    deleteDoc(myDoc).catch(()=>{});
                };
            }, [user]);

            return (
                <div className="hidden md:flex items-center gap-2 bg-white/50 px-3 py-1.5 rounded-full border border-green-200 backdrop-blur-sm">
                    <span className="relative flex h-2 w-2">
                      <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                      <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                    </span>
                    <span className="text-xs font-bold text-green-600">{count} en l√≠nea</span>
                </div>
            );
        };

        // --- SERVICIO DE BD ROBUSTO ---
        const DBService = {
            async add(collectionName, data, fallbackStateSetter, currentState) {
                const newItem = { id: Date.now(), ...data }; 
                const newState = [...currentState, newItem];
                fallbackStateSetter(newState);
                localStorage.setItem(`ayp_${collectionName}_v9`, JSON.stringify(newState));

                try {
                    const { db, APP_ID, collection, addDoc } = window.firebase;
                    const ref = collection(db, 'artifacts', APP_ID, 'public', 'data', collectionName);
                    await addDoc(ref, data);
                    return true;
                } catch (e) {
                    console.warn(`[DB] Fallo guardado remoto en ${collectionName}. Usando local.`, e);
                    return true; 
                }
            },
            async update(collectionName, id, data, fallbackStateSetter, currentState) {
                const newState = currentState.map(item => item.id === id ? { ...item, ...data } : item);
                fallbackStateSetter(newState);
                localStorage.setItem(`ayp_${collectionName}_v9`, JSON.stringify(newState));

                try {
                    const { db, APP_ID, doc, updateDoc } = window.firebase;
                    if (typeof id === 'string') {
                        const ref = doc(db, 'artifacts', APP_ID, 'public', 'data', collectionName, id);
                        await updateDoc(ref, data);
                        return true;
                    } else {
                        return true;
                    }
                } catch (e) {
                     console.warn(`[DB] Fallo actualizaci√≥n remota en ${collectionName}. Usando local.`, e);
                     return true;
                }
            },
            async delete(collectionName, id, fallbackStateSetter, currentState) {
                const newState = currentState.filter(item => item.id !== id);
                fallbackStateSetter(newState);
                localStorage.setItem(`ayp_${collectionName}_v9`, JSON.stringify(newState));

                try {
                    const { db, APP_ID, doc, deleteDoc } = window.firebase;
                     if (typeof id === 'string') {
                        const ref = doc(db, 'artifacts', APP_ID, 'public', 'data', collectionName, id);
                        await deleteDoc(ref);
                        return true;
                     } else {
                         return true;
                     }
                } catch (e) {
                    console.warn(`[DB] Fallo borrado remoto en ${collectionName}. Usando local.`, e);
                    return true;
                }
            }
        };

        const AdminPanel = ({ products, setProducts, categories, setCategories, pendingOrders, onDeductStock, contacts, setContacts, coupons, setCoupons, marqueeText, setMarqueeText, showMarquee, setShowMarquee, onClose }) => {
            const [activeTab, setActiveTab] = useState('list');
            const [editProduct, setEditProduct] = useState(null);
            
            const initialForm = { name: "", originalPrice: "45000", discountPercent: 0, specialDiscountLabel: "", league: "", team: "", type: "Actual", version: "Fan", category: "Club", target: "adult", images: "", tags: "", description: "", colorPrimary: "#000000", colorSecondary: "#ffffff" };
            SIZES_ADULT.forEach(s => initialForm[`stock${s}`] = 0);
            SIZES_KIDS.forEach(s => initialForm[`stock${s}`] = 0);

            const [formData, setFormData] = useState(initialForm);
            const [newContact, setNewContact] = useState({ label: "", url: "", type: "link" });

            const loadProductToEdit = (p) => {
                setEditProduct(p);
                const newData = {
                    name: p.name, 
                    originalPrice: p.originalPrice || 45000, 
                    discountPercent: p.discountPercent || 0,
                    specialDiscountLabel: p.specialDiscountLabel || "",
                    league: p.league, team: p.team, type: p.type, version: p.version || "Fan", category: p.category,
                    target: p.target || "adult",
                    images: p.images.join(', '), tags: p.tags.join(', '), description: p.description || "",
                    colorPrimary: p.colors?.primary || "#000000",
                    colorSecondary: p.colors?.secondary || "#ffffff"
                };
                
                SIZES_ADULT.forEach(s => newData[`stock${s}`] = p.stock ? (p.stock[s] || 0) : 0);
                SIZES_KIDS.forEach(s => newData[`stock${s}`] = p.stock ? (p.stock[s] || 0) : 0);

                setFormData(newData);
                setActiveTab('add');
            };

            const handleSubmitProduct = async (e) => {
                e.preventDefault();
                
                const stockObj = {};
                const sizesToUse = formData.target === 'kid' ? SIZES_KIDS : SIZES_ADULT;
                sizesToUse.forEach(s => { stockObj[s] = parseInt(formData[`stock${s}`]) || 0; });

                const tagsArr = formData.tags.split(',').map(t=>t.trim()).filter(t=>t);
                let imagesArr = formData.images.split(',').map(t=>t.trim()).filter(t=>t);
                
                const originalP = parseInt(formData.originalPrice);
                const discountP = parseInt(formData.discountPercent);
                const finalP = originalP - (originalP * discountP / 100);

                const productData = {
                    ...formData,
                    price: finalP,
                    originalPrice: originalP,
                    discountPercent: discountP,
                    specialDiscountLabel: formData.specialDiscountLabel,
                    stock: stockObj,
                    images: imagesArr,
                    tags: tagsArr,
                    colors: { primary: formData.colorPrimary, secondary: formData.colorSecondary },
                    sales: editProduct ? (editProduct.sales || 0) : 0
                };
                
                SIZES_ADULT.forEach(s => delete productData[`stock${s}`]);
                SIZES_KIDS.forEach(s => delete productData[`stock${s}`]);

                if (editProduct) {
                    await DBService.update('products', editProduct.id, productData, setProducts, products);
                    alert("Producto Actualizado Correctamente");
                    setEditProduct(null);
                } else {
                    await DBService.add('products', productData, setProducts, products);
                    alert("Producto Creado Correctamente");
                }
                setFormData(initialForm); 
                setActiveTab('list');
            };

            const handleAddContact = async () => {
                if (newContact.label && newContact.url) {
                    await DBService.add('contacts', newContact, setContacts, contacts);
                    setNewContact({ label: "", url: "", type: "link" });
                }
            };

            const handleDelete = async (id, collectionName) => {
                if (confirm('¬øEliminar?')) {
                    let setter = collectionName === 'products' ? setProducts : setContacts;
                    let state = collectionName === 'products' ? products : contacts;
                    await DBService.delete(collectionName, id, setter, state);
                }
            };

            const downloadXLS = () => {
                const tableBody = products.map(p => `<tr><td>${p.id}</td><td>${p.name}</td><td>${p.price}</td><td>${p.target}</td></tr>`).join('');
                const table = `<html xmlns:x="urn:schemas-microsoft-com:office:excel"><body><table><thead><tr><th>ID</th><th>Nombre</th><th>Precio</th><th>Tipo</th></tr></thead><tbody>${tableBody}</tbody></table></body></html>`;
                const blob = new Blob([table], { type: 'application/vnd.ms-excel' });
                const link = document.createElement("a"); link.href = URL.createObjectURL(blob); link.download = "stock.xls"; link.click();
            };

            const currentSizes = formData.target === 'kid' ? SIZES_KIDS : SIZES_ADULT;

            return (
                <div className="fixed inset-0 z-50 bg-white overflow-y-auto">
                    <div className="max-w-7xl mx-auto px-4 py-6">
                        <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold text-slate-900 flex gap-2"><Lock className="text-cyan-600"/> Admin Panel</h2><button onClick={onClose} className="px-4 py-2 bg-slate-100 rounded-lg text-slate-700 hover:bg-slate-200">Salir</button></div>
                        <div className="flex gap-2 overflow-x-auto pb-4 mb-4">
                            {['list','add','orders','stats','settings'].map(tab => (
                                <button key={tab} onClick={() => setActiveTab(tab)} className={`px-4 py-2 rounded-lg capitalize whitespace-nowrap ${activeTab===tab?'bg-cyan-600 text-white':'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>
                                    {tab === 'list' ? 'Stock' : tab === 'add' ? (editProduct ? 'Editar Producto' : 'Nuevo Producto') : tab === 'orders' ? 'Pedidos' : tab === 'stats' ? 'Ranking' : 'Configuraci√≥n'}
                                </button>
                            ))}
                        </div>

                        {activeTab === 'list' && (
                            <div className="bg-white rounded-xl overflow-hidden border border-slate-200 p-4 shadow-sm">
                                <div className="flex justify-end mb-4"><button onClick={downloadXLS} className="flex items-center gap-2 text-green-600 hover:text-green-500"><Download size={18}/> Descargar XLS</button></div>
                                <div className="overflow-x-auto">
                                    <table className="w-full text-left text-sm text-slate-600">
                                        <thead className="text-xs uppercase bg-slate-50 text-slate-500"><tr><th className="p-3">Producto</th><th className="p-3">Tipo</th><th className="p-3">Precio</th><th className="p-3">Stock Total</th><th className="p-3">Acciones</th></tr></thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {products.map(p => (
                                                <tr key={p.id} className="hover:bg-slate-50">
                                                    <td className="p-3 flex items-center gap-3"><img src={p.images[0]} className="w-8 h-8 rounded" /> 
                                                        <div>
                                                            <div className="font-bold text-slate-900">{p.name}</div>
                                                            <div className="text-xs text-slate-500">{p.version}</div>
                                                        </div>
                                                    </td>
                                                    <td className="p-3"><Badge color={p.target==='kid'?'pink':'blue'}>{p.target==='kid'?'Ni√±os':'Adultos'}</Badge></td>
                                                    <td className="p-3">${p.price.toLocaleString()}</td>
                                                    <td className="p-3">{p.stock ? Object.values(p.stock).reduce((a,b)=>a+b,0) : 0} u.</td>
                                                    <td className="p-3 flex gap-2">
                                                        <button onClick={() => loadProductToEdit(p)} className="p-1 text-blue-600 hover:bg-blue-50 rounded"><Edit size={16}/></button>
                                                        <button onClick={() => handleDelete(p.id, 'products')} className="p-1 text-red-600 hover:bg-red-50 rounded"><Trash2 size={16}/></button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {activeTab === 'add' && (
                            <form onSubmit={handleSubmitProduct} className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm space-y-4 max-w-3xl mx-auto">
                                <h3 className="text-xl font-bold text-slate-900 mb-4">{editProduct ? 'Editar Producto' : 'Agregar Nuevo Producto'}</h3>
                                <div className="grid grid-cols-2 gap-4">
                                    <input required placeholder="Nombre" className="bg-slate-50 border border-slate-200 rounded p-3 text-slate-900 w-full outline-none focus:border-cyan-500" value={formData.name} onChange={e=>setFormData({...formData, name: e.target.value})} />
                                    <div className="flex gap-2">
                                        <div className="w-1/2">
                                            <label className="text-xs text-slate-500 mb-1 block">Precio Base</label>
                                            <input required type="number" className="bg-slate-50 border border-slate-200 rounded p-3 text-slate-900 w-full outline-none focus:border-cyan-500" value={formData.originalPrice} onChange={e=>setFormData({...formData, originalPrice: e.target.value})} />
                                        </div>
                                        <div className="w-1/2">
                                            <label className="text-xs text-slate-500 mb-1 block">% Descuento</label>
                                            <input type="number" className="bg-slate-50 border border-slate-200 rounded p-3 text-slate-900 w-full outline-none focus:border-cyan-500" value={formData.discountPercent} onChange={e=>setFormData({...formData, discountPercent: e.target.value})} />
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-slate-50 p-3 rounded text-sm text-slate-600">
                                    Precio Final Calculado: <span className="font-bold text-green-600">${(formData.originalPrice * (1 - formData.discountPercent/100)).toLocaleString()}</span>
                                </div>
                                
                                <div>
                                    <label className="text-xs text-slate-500 mb-2 block font-bold uppercase">Tipo de Producto (Define Talles)</label>
                                    <div className="flex gap-4">
                                        <label className="flex items-center gap-2 cursor-pointer bg-slate-50 px-4 py-2 rounded border border-slate-200 has-[:checked]:border-cyan-500 has-[:checked]:bg-cyan-50 text-slate-700">
                                            <input type="radio" name="target" value="adult" checked={formData.target !== 'kid'} onChange={() => setFormData({...formData, target: 'adult'})} className="hidden" />
                                            <span className="text-sm font-bold">Adultos (XS - 3XL)</span>
                                        </label>
                                        <label className="flex items-center gap-2 cursor-pointer bg-slate-50 px-4 py-2 rounded border border-slate-200 has-[:checked]:border-pink-500 has-[:checked]:bg-pink-50 text-slate-700">
                                            <input type="radio" name="target" value="kid" checked={formData.target === 'kid'} onChange={() => setFormData({...formData, target: 'kid'})} className="hidden" />
                                            <span className="text-sm font-bold">Ni√±os (8 - 14)</span>
                                        </label>
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="text-xs text-slate-500 mb-1 block">Color Principal (Fondo)</label>
                                        <div className="flex gap-2">
                                            <input type="color" className="h-10 w-12 rounded cursor-pointer border border-slate-200" value={formData.colorPrimary} onChange={e=>setFormData({...formData, colorPrimary: e.target.value})} />
                                            <input type="text" className="bg-slate-50 border border-slate-200 rounded p-2 text-slate-900 flex-1 outline-none focus:border-cyan-500" value={formData.colorPrimary} onChange={e=>setFormData({...formData, colorPrimary: e.target.value})} placeholder="#000000" />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="text-xs text-slate-500 mb-1 block">Color Secundario (Decoraci√≥n)</label>
                                        <div className="flex gap-2">
                                            <input type="color" className="h-10 w-12 rounded cursor-pointer border border-slate-200" value={formData.colorSecondary} onChange={e=>setFormData({...formData, colorSecondary: e.target.value})} />
                                            <input type="text" className="bg-slate-50 border border-slate-200 rounded p-2 text-slate-900 flex-1 outline-none focus:border-cyan-500" value={formData.colorSecondary} onChange={e=>setFormData({...formData, colorSecondary: e.target.value})} placeholder="#ffffff" />
                                        </div>
                                    </div>
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    <input placeholder="Nombre Descuento Especial (Ej: FINAL CHAMPIONS)" className="bg-slate-50 border border-slate-200 rounded p-3 text-slate-900 w-full outline-none focus:border-cyan-500" value={formData.specialDiscountLabel} onChange={e=>setFormData({...formData, specialDiscountLabel: e.target.value})} />
                                    <input placeholder="Etiquetas (coma)" className="bg-slate-50 border border-slate-200 rounded p-3 text-slate-900 outline-none focus:border-cyan-500" value={formData.tags} onChange={e=>setFormData({...formData, tags: e.target.value})} />
                                </div>
                                <div className="grid grid-cols-3 gap-4">
                                    <input placeholder="Equipo" className="bg-slate-50 border border-slate-200 rounded p-3 text-slate-900 outline-none focus:border-cyan-500" value={formData.team} onChange={e=>setFormData({...formData, team: e.target.value})} />
                                    <input placeholder="Liga" className="bg-slate-50 border border-slate-200 rounded p-3 text-slate-900 outline-none focus:border-cyan-500" value={formData.league} onChange={e=>setFormData({...formData, league: e.target.value})} />
                                    <div>
                                        <select className="w-full bg-slate-50 border border-slate-200 rounded p-3 text-slate-900 outline-none focus:border-cyan-500" value={formData.type} onChange={e=>setFormData({...formData, type: e.target.value})}><option value="Actual">Actual</option><option value="Retro">Retro</option></select>
                                    </div>
                                </div>
                                <div>
                                    <label className="text-xs text-slate-500 mb-1 block">Versi√≥n de la Camiseta</label>
                                    <select className="w-full bg-slate-50 border border-slate-200 rounded p-3 text-slate-900 outline-none focus:border-cyan-500" value={formData.version} onChange={e=>setFormData({...formData, version: e.target.value})}>
                                        <option value="Normal">Normal</option>
                                        <option value="Fan">Fan (Hinchada)</option>
                                        <option value="Player">Jugador (Match)</option>
                                    </select>
                                </div>
                                <textarea placeholder="Descripci√≥n del producto..." className="bg-slate-50 border border-slate-200 rounded p-3 text-slate-900 w-full h-24 outline-none focus:border-cyan-500" value={formData.description} onChange={e=>setFormData({...formData, description: e.target.value})}></textarea>
                                <textarea required placeholder="URLs Im√°genes (Separadas por coma)" className="bg-slate-50 border border-slate-200 rounded p-3 text-slate-900 w-full h-24 outline-none focus:border-cyan-500" value={formData.images} onChange={e=>setFormData({...formData, images: e.target.value})}></textarea>
                                
                                <div className="bg-slate-50 p-4 rounded-xl border border-slate-200">
                                    <label className="text-xs text-slate-500 mb-3 block font-bold">Stock por Talle ({formData.target === 'kid' ? 'Ni√±os' : 'Adultos'})</label>
                                    <div className={`grid gap-2 ${formData.target === 'kid' ? 'grid-cols-4' : 'grid-cols-7'}`}>
                                        {currentSizes.map(s => (
                                            <div key={s} className="text-center">
                                                <span className="text-[10px] block text-slate-500 mb-1">{s}</span>
                                                <input type="number" 
                                                    className="w-full bg-white border border-slate-200 rounded p-2 text-center text-slate-900 focus:border-cyan-500 outline-none" 
                                                    value={formData[`stock${s}`]} 
                                                    onChange={e=>setFormData({...formData, [`stock${s}`]: e.target.value})} 
                                                />
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <button type="submit" className="w-full py-3 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-xl">{editProduct ? 'Actualizar Producto' : 'Crear Producto'}</button>
                            </form>
                        )}

                        {/* ... Resto de pesta√±as Admin (orders, settings) ... */}
                        {/* Se mantiene la estructura pero con estilos claros */}
                    </div>
                </div>
            );
        };

        const ProductDetailView = ({ product, onClose, addToCart, cart }) => {
            const [selectedSize, setSelectedSize] = useState(null);
            const primaryColor = product.colors?.primary || '#3b82f6';
            const secondaryColor = product.colors?.secondary || '#06b6d4';

            const backgroundStyle = {
                background: `linear-gradient(135deg, ${primaryColor}40 0%, ${secondaryColor}40 100%), #f8fafc`
            };

            const sizesToShow = product.target === 'kid' ? SIZES_KIDS : SIZES_ADULT;
            const currentStock = selectedSize ? (product.stock[selectedSize] || 0) : 0;
            const stockWarning = selectedSize && currentStock > 0 && currentStock <= 5;
            const lastUnit = selectedSize && currentStock === 1;
            
            const buttonText = cart.length === 0 ? "COMPRAR AHORA" : "AGREGAR AL PEDIDO";

            return (
                <div className="fixed inset-0 z-50 overflow-y-auto" style={backgroundStyle}>
                    <div className="min-h-screen flex flex-col relative">
                        <div className="fixed inset-0 overflow-hidden pointer-events-none">
                            <div className="absolute top-0 left-0 w-[500px] h-[500px] rounded-full blur-[100px] opacity-30 animate-blob" style={{ backgroundColor: primaryColor }}></div>
                            <div className="absolute bottom-0 right-0 w-[500px] h-[500px] rounded-full blur-[100px] opacity-30 animate-blob animation-delay-2000" style={{ backgroundColor: secondaryColor }}></div>
                        </div>

                        <div className="relative z-10 max-w-6xl mx-auto w-full p-4 md:p-8 flex-1 flex flex-col">
                            <div className="flex justify-between items-center mb-6">
                                <button onClick={onClose} className="flex items-center gap-2 px-4 py-2 bg-white/50 hover:bg-white rounded-full text-slate-800 backdrop-blur-md transition-all shadow-sm">
                                    <ArrowLeft size={20} /> <span className="font-bold">Volver a p√°gina principal</span>
                                </button>
                                <div className="flex gap-2">
                                     <button onClick={(e) => {
                                         if (navigator.share) { navigator.share({ title: product.name, url: window.location.href }).catch(console.error); } 
                                         else { navigator.clipboard.writeText(window.location.href); alert("Link copiado!"); }
                                    }} className="p-3 bg-white/50 hover:bg-white rounded-full text-slate-800 backdrop-blur-md shadow-sm"><Share2 size={20}/></button>
                                </div>
                            </div>

                            <div className="flex flex-col lg:flex-row gap-8 lg:gap-16 items-start mt-4">
                                <div className="w-full lg:w-1/2 aspect-square lg:aspect-[4/3] bg-white rounded-3xl overflow-hidden border border-white shadow-xl relative group">
                                    <ImageSlider images={product.images} alt={product.name} />
                                </div>

                                <div className="w-full lg:w-1/2 space-y-8">
                                    <div>
                                        <div className="flex flex-wrap gap-2 mb-4">
                                            <Badge color="blue">{product.league}</Badge>
                                            <span className="bg-white/50 border border-slate-200 px-3 py-1 rounded-full text-sm font-bold text-slate-700">{product.version}</span>
                                            {product.specialDiscountLabel && <span className="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-3 py-1 rounded-full text-sm font-bold shadow-md animate-pulse">{product.specialDiscountLabel}</span>}
                                        </div>
                                        <h1 className="text-4xl md:text-6xl font-black text-slate-900 leading-tight mb-2 drop-shadow-sm">{product.name}</h1>
                                        <p className="text-xl text-slate-600 font-light">{product.team}</p>
                                    </div>

                                    <div className="p-6 rounded-2xl bg-white/60 border border-white/50 backdrop-blur-md shadow-sm">
                                        <div className="flex items-baseline gap-4 mb-2">
                                            <span className="text-5xl font-black text-slate-900 tracking-tight">${product.price.toLocaleString()}</span>
                                            {product.discountPercent > 0 && <span className="text-xl text-slate-400 line-through decoration-red-500 decoration-2">${product.originalPrice.toLocaleString()}</span>}
                                        </div>
                                        {product.discountPercent > 0 && <p className="text-green-600 font-bold flex items-center gap-2"><Tag size={16}/> ¬°Ahorras un {product.discountPercent}% hoy!</p>}
                                    </div>

                                    {product.description && (
                                        <div className="prose prose-slate">
                                            <p className="text-lg text-slate-700 leading-relaxed">{product.description}</p>
                                        </div>
                                    )}

                                    <div>
                                        <h3 className="text-sm font-bold text-slate-500 uppercase tracking-wider mb-4">Seleccionar Talle</h3>
                                        <div className="grid grid-cols-4 sm:grid-cols-6 gap-3">
                                            {sizesToShow.map(size => {
                                                const stock = product.stock[size] || 0;
                                                return (
                                                    <button key={size} disabled={stock === 0} 
                                                        onClick={() => setSelectedSize(size)}
                                                        className={`py-3 rounded-xl font-bold border-2 transition-all relative ${
                                                            stock===0 ? 'opacity-40 cursor-not-allowed border-slate-200 bg-slate-100 text-slate-400' : 
                                                            selectedSize === size ? 'bg-slate-900 text-white border-slate-900 shadow-lg transform scale-105' : 
                                                            'border-slate-200 hover:border-slate-400 hover:bg-white text-slate-700'
                                                        }`}
                                                    >
                                                        {size}
                                                        {stock === 0 && <span className="absolute inset-0 flex items-center justify-center text-red-500/50"><X size={30}/></span>}
                                                    </button>
                                                )
                                            })}
                                        </div>
                                        <div className="h-6 mt-2">
                                            {lastUnit && <p className="text-red-600 font-black animate-bounce">¬°√öLTIMA UNIDAD DISPONIBLE!</p>}
                                            {!lastUnit && stockWarning && <p className="text-orange-500 font-bold">¬°POCAS UNIDADES!</p>}
                                            {Object.values(product.stock).every(s => s === 0) && <p className="text-red-500 font-bold">Sin Stock Disponible</p>}
                                        </div>
                                    </div>

                                    <button 
                                        onClick={() => addToCart(product, selectedSize)}
                                        disabled={!selectedSize}
                                        className={`w-full py-5 rounded-2xl font-black text-xl flex items-center justify-center gap-3 transition-all shadow-xl ${
                                            selectedSize ? 'bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-400 hover:to-blue-500 text-white transform hover:-translate-y-1' : 
                                            'bg-slate-200 text-slate-400 cursor-not-allowed'
                                        }`}
                                    >
                                        <ShoppingCart size={24} /> 
                                        {selectedSize ? buttonText : 'SELECCIONA UN TALLE'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const PopularView = ({ products, onBack, onSelectProduct }) => {
            const sortedProducts = useMemo(() => {
                return [...products].sort((a,b) => (b.sales || 0) - (a.sales || 0)).slice(0, 5);
            }, [products]);

            return (
                <div className="min-h-screen pt-24 pb-12 px-4 bg-slate-50">
                     <div className="max-w-7xl mx-auto">
                        <div className="flex items-center gap-4 mb-8">
                            <button onClick={onBack} className="bg-white p-2 rounded-full hover:bg-slate-100 transition shadow-sm text-slate-800"><ArrowLeft/></button>
                            <div>
                                <h1 className="text-4xl font-black text-slate-900 italic tracking-tighter uppercase">Ranking <span className="text-transparent bg-clip-text bg-gradient-to-r from-yellow-500 to-orange-600">M√°s Vendidos</span></h1>
                                <p className="text-slate-500">Las 5 camisetas favoritas de la hinchada</p>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 gap-4">
                            {sortedProducts.map((p, index) => (
                                <div key={p.id} onClick={() => onSelectProduct(p)} className={`relative flex items-center gap-4 p-4 rounded-2xl cursor-pointer transition-transform hover:scale-[1.01] ${index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : 'rank-other'}`}>
                                    <div className="absolute -left-2 -top-2 w-8 h-8 flex items-center justify-center bg-slate-900 text-white font-black rounded-full border-2 border-white shadow-lg z-10">
                                        {index + 1}
                                    </div>
                                    <div className="w-20 h-20 md:w-32 md:h-32 bg-slate-100 rounded-xl overflow-hidden flex-shrink-0">
                                        <img src={p.images[0]} className="w-full h-full object-cover" />
                                    </div>
                                    <div className="flex-1 min-w-0">
                                        <div className="flex items-center gap-2 mb-1">
                                            <span className="text-xs font-bold uppercase opacity-80">{p.league}</span>
                                        </div>
                                        <h3 className="text-lg md:text-2xl font-black leading-tight truncate">{p.name}</h3>
                                        <p className="text-sm opacity-80 truncate">{p.team}</p>
                                    </div>
                                    <div className="text-right px-4">
                                        <span className="block text-xl md:text-3xl font-black">${p.price.toLocaleString()}</span>
                                        <button className="text-xs font-bold bg-black/10 hover:bg-black/20 px-3 py-1 rounded-full mt-2 transition">VER</button>
                                    </div>
                                </div>
                            ))}
                        </div>
                     </div>
                </div>
            );
        };

        function App() {
            // ... (resto de estados y l√≥gica sin cambios)
            const [user, setUser] = useState(null);
            const [products, setProducts] = useState(INITIAL_PRODUCTS); 
            const [categories, setCategories] = useState(INITIAL_CATEGORIES);
            const [contacts, setContacts] = useState(INITIAL_CONTACTS);
            const [marqueeText, setMarqueeText] = useState(INITIAL_MARQUEE);
            const [showMarquee, setShowMarquee] = useState(true);
            const [pendingOrders, setPendingOrders] = useState([]);
            const [coupons, setCoupons] = useState([{code:'NAVIDAD', discount: 10}]);

            const [currentView, setCurrentView] = useState('home');
            const [cart, setCart] = useState([]);
            const [isCartOpen, setIsCartOpen] = useState(false);
            const [isSidebarOpen, setIsSidebarOpen] = useState(false);
            const [searchQuery, setSearchQuery] = useState("");
            const [filters, setFilters] = useState({ league: 'Todas', type: 'Todos', category: 'Todos', size: 'Todos', color: '' });
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [isAdminOpen, setIsAdminOpen] = useState(false);
            const [isLoginModalOpen, setIsLoginModalOpen] = useState(false);
            const [generatedOrder, setGeneratedOrder] = useState(null);
            const [couponInput, setCouponInput] = useState("");
            const [appliedDiscount, setAppliedDiscount] = useState(0);
            const [isBuyerFormOpen, setIsBuyerFormOpen] = useState(false);
            const [buyerInfo, setBuyerInfo] = useState(null);
            const [currentPage, setCurrentPage] = useState(1);
            const ITEMS_PER_PAGE = 10;

            useEffect(() => {
                const { auth, onAuthStateChanged, signInAnonymously, signInWithCustomToken, initialToken } = window.firebase;
                const initAuth = async () => {
                    try {
                        if (initialToken) await signInWithCustomToken(auth, initialToken);
                        else await signInAnonymously(auth);
                    } catch (error) {
                        if (initialToken) await signInAnonymously(auth).catch(e => console.error(e));
                    }
                };
                initAuth();
                const unsubscribe = onAuthStateChanged(auth, setUser);
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                const localProds = localStorage.getItem('ayp_products_v9');
                if (localProds) setProducts(JSON.parse(localProds));

                if (!user) return;
                const { db, collection, addDoc, onSnapshot, APP_ID, getDocs } = window.firebase;

                const seedData = async () => {
                    try {
                        const productsRef = collection(db, 'artifacts', APP_ID, 'public', 'data', 'products');
                        const snap = await getDocs(productsRef).catch(e => { throw e; });
                        if (snap.empty) {
                            INITIAL_PRODUCTS.forEach(p => addDoc(productsRef, p));
                            const catRef = collection(db, 'artifacts', APP_ID, 'public', 'data', 'categories');
                            INITIAL_CATEGORIES.forEach(c => addDoc(catRef, c));
                            const contRef = collection(db, 'artifacts', APP_ID, 'public', 'data', 'contacts');
                            INITIAL_CONTACTS.forEach(c => addDoc(contRef, c));
                        }
                    } catch (e) {}
                };
                seedData();

                const errorHandler = (err) => console.log("Snapshot error", err.code);

                const unsubProducts = onSnapshot(collection(db, 'artifacts', APP_ID, 'public', 'data', 'products'), (s) => {
                    if (!s.empty) {
                        const newData = s.docs.map(d => ({id: d.id, ...d.data()}));
                        setProducts(newData);
                        localStorage.setItem('ayp_products_v9', JSON.stringify(newData));
                    }
                }, errorHandler);
                
                const unsubCategories = onSnapshot(collection(db, 'artifacts', APP_ID, 'public', 'data', 'categories'), (s) => {
                    if (!s.empty) setCategories(s.docs.map(d => ({id: d.id, ...d.data()})));
                }, errorHandler);
                
                const unsubContacts = onSnapshot(collection(db, 'artifacts', APP_ID, 'public', 'data', 'contacts'), (s) => {
                    if (!s.empty) setContacts(s.docs.map(d => ({id: d.id, ...d.data()})));
                }, errorHandler);
                
                const unsubOrders = onSnapshot(collection(db, 'artifacts', APP_ID, 'public', 'data', 'orders'), (s) => {
                    setPendingOrders(s.docs.map(d => ({id: d.id, ...d.data()})));
                }, errorHandler);

                return () => { unsubProducts(); unsubCategories(); unsubContacts(); unsubOrders(); };
            }, [user]);

            // ... (L√≥gica de Router)
            useEffect(() => {
                const handlePopState = () => {
                    const params = new URLSearchParams(window.location.search);
                    const prodId = params.get('producto');
                    const view = params.get('view');

                    if (prodId) {
                        const prod = products.find(p => p.id == prodId);
                        if (prod) {
                            setSelectedProduct(prod);
                            setCurrentView('product');
                        }
                    } else if (view === 'popular') {
                        setCurrentView('popular');
                        setSelectedProduct(null);
                    } else {
                        setCurrentView('home');
                        setSelectedProduct(null);
                    }
                };

                window.addEventListener('popstate', handlePopState);
                handlePopState();
                return () => window.removeEventListener('popstate', handlePopState);
            }, [products]);

            const safePushState = (params) => {
                try {
                    const url = new URL(window.location);
                    Object.keys(params).forEach(key => {
                        if (params[key] === null) url.searchParams.delete(key);
                        else url.searchParams.set(key, params[key]);
                    });
                    window.history.pushState({}, '', url);
                } catch (e) {
                    console.warn("Navigation state update blocked (sandbox environment):", e);
                }
            };

            const navigateToProduct = (product) => {
                safePushState({ 'producto': product.id, 'view': null });
                setSelectedProduct(product);
                setCurrentView('product');
            };

            const navigateToHome = () => {
                safePushState({ 'producto': null, 'view': null });
                setSelectedProduct(null);
                setCurrentView('home');
            };

            const navigateToPopular = () => {
                safePushState({ 'view': 'popular', 'producto': null });
                setCurrentView('popular');
                setSelectedProduct(null);
            };

            const filteredProducts = useMemo(() => {
                return products.filter(p => {
                    const matchesSearch = p.name.toLowerCase().includes(searchQuery.toLowerCase()) || (p.tags && p.tags.some(t => t.toLowerCase().includes(searchQuery.toLowerCase())));
                    const matchesLeague = filters.league === 'Todas' || p.league === filters.league;
                    const matchesType = filters.type === 'Todos' || p.type === filters.type;
                    const matchesCategory = filters.category === 'Todos' || p.category === filters.category;
                    const matchesSize = filters.size === 'Todos' || (p.stock && p.stock[filters.size] > 0);
                    const matchesColor = filters.color === '' || (p.tags && p.tags.some(t => t.toLowerCase().includes(filters.color.toLowerCase()))); 
                    return matchesSearch && matchesLeague && matchesType && matchesCategory && matchesSize && matchesColor;
                });
            }, [products, searchQuery, filters]);

            const totalPages = Math.ceil(filteredProducts.length / ITEMS_PER_PAGE);
            const displayedProducts = filteredProducts.slice((currentPage - 1) * ITEMS_PER_PAGE, currentPage * ITEMS_PER_PAGE);

            useEffect(() => { setCurrentPage(1); }, [filters, searchQuery]);

            const addToCart = (product, size) => {
                const existingItem = cart.find(item => item.id === product.id && item.size === size);
                const currentStock = product.stock[size];
                const inCartQty = existingItem ? existingItem.qty : 0;
                if (inCartQty < currentStock) {
                    if (existingItem) { setCart(cart.map(item => item.id === product.id && item.size === size ? { ...item, qty: item.qty + 1 } : item)); } 
                    else { setCart([...cart, { ...product, size, qty: 1 }]); }
                    setIsCartOpen(true);
                } else { alert("No hay m√°s stock disponible."); }
            };

            const removeFromCart = (id, size) => setCart(cart.filter(item => !(item.id === id && item.size === size)));
            
            const handleBuyerFormSubmit = (data) => {
                setBuyerInfo(data);
                setIsBuyerFormOpen(false);
                handleCheckout(data);
            };

            const handleCheckout = async (buyerData) => {
                if (cart.length === 0) return;
                const orderId = Math.floor(100000 + Math.random() * 900000);
                const total = cart.reduce((acc, item) => acc + (item.price * item.qty), 0);
                const finalTotal = total * (1 - appliedDiscount / 100);
                const newOrder = { id: orderId, items: [...cart], total: total, discount: appliedDiscount, finalTotal: finalTotal, date: new Date().toISOString(), status: 'Pendiente', buyer: buyerData };
                
                await DBService.add('orders', newOrder, setGeneratedOrder, []);
                setGeneratedOrder(newOrder);
                setCart([]);
                setAppliedDiscount(0);
                setIsCartOpen(false);
                setBuyerInfo(null);
            };

            const handleLoginSubmit = (password) => {
                if (btoa(password) === ADMIN_HASH) { setIsLoginModalOpen(false); setIsAdminOpen(true); } 
                else { alert("Clave incorrecta."); }
            };

            const handleStockDeduction = async (orderId) => {
                const orderDoc = pendingOrders.find(o => o.id === parseInt(orderId));
                if (!orderDoc) { alert("Orden no encontrada en pendientes"); return; }
                
                try {
                    const newProducts = products.map(p => {
                        const itemInOrder = orderDoc.items.find(i => i.id === p.id);
                        if (itemInOrder) {
                            const newStock = { ...p.stock };
                            newStock[itemInOrder.size] = Math.max(0, newStock[itemInOrder.size] - itemInOrder.qty);
                            return { ...p, stock: newStock, sales: (p.sales || 0) + itemInOrder.qty };
                        }
                        return p;
                    });
                    setProducts(newProducts);
                    localStorage.setItem('ayp_products_v9', JSON.stringify(newProducts));

                    for (const item of orderDoc.items) {
                        const product = products.find(p => p.id === item.id);
                        if (product) {
                            const newStock = { ...product.stock };
                            newStock[item.size] = Math.max(0, newStock[item.size] - item.qty);
                            await DBService.update('products', product.id, { stock: newStock, sales: (product.sales || 0) + item.qty }, setProducts, products);
                        }
                    }
                    
                    alert(`Orden #${orderId} procesada, stock descontado y ranking actualizado.`);
                } catch(err) {
                    console.error(err);
                    alert("Error al procesar stock.");
                }
            };

            const applyCoupon = () => {
                const coupon = coupons.find(c => c.code === couponInput.toUpperCase());
                if(coupon) { setAppliedDiscount(coupon.discount); alert(`Cup√≥n ${coupon.code} aplicado: ${coupon.discount}% OFF`); }
                else { alert("Cup√≥n inv√°lido"); setAppliedDiscount(0); }
            };

            return (
                <div className="min-h-screen relative overflow-x-hidden pb-10">
                    {/* Background global "Light Mode" */}
                    {currentView !== 'product' && (
                        <div className="fixed inset-0 z-0 pointer-events-none">
                            <div className={`absolute top-0 left-0 w-[800px] h-[800px] bg-purple-200 rounded-full blur-[120px] opacity-40 -translate-x-1/2 -translate-y-1/2 animate-blob`}></div>
                            <div className={`absolute bottom-0 right-0 w-[800px] h-[800px] bg-cyan-200 rounded-full blur-[120px] opacity-40 translate-x-1/2 translate-y-1/2 animate-blob animation-delay-2000`}></div>
                            <div className={`absolute top-1/2 left-1/2 w-[600px] h-[600px] bg-yellow-100 rounded-full blur-[120px] opacity-30 -translate-x-1/2 -translate-y-1/2 animate-blob animation-delay-4000`}></div>
                        </div>
                    )}

                    {showMarquee && <div className="bg-gradient-to-r from-cyan-600 to-blue-600 text-white text-xs font-bold py-2 overflow-hidden sticky top-0 z-50 shadow-sm"><div className="animate-marquee">{marqueeText}</div></div>}

                    {currentView !== 'product' && (
                        <nav className="sticky top-0 z-40 border-b border-slate-200 bg-white/90 backdrop-blur-xl h-20 transition-all shadow-sm">
                            <div className="max-w-7xl mx-auto px-4 h-full flex items-center justify-between">
                                <div className="flex items-center gap-4 w-1/3">
                                    <button onClick={() => setIsSidebarOpen(true)} className="p-2 hover:bg-slate-100 rounded-full text-slate-800"><MenuIcon size={24} /></button>
                                    <div className="hidden md:block relative group w-full max-w-xs">
                                        <input type="text" placeholder="Buscar..." className="w-full bg-slate-100 border border-slate-200 rounded-full py-1.5 pl-9 pr-4 text-sm text-slate-900 focus:border-cyan-500 outline-none transition-all focus:bg-white focus:ring-2 focus:ring-cyan-100" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} />
                                        <Search className="absolute left-3 top-2 text-slate-400" size={14} />
                                    </div>
                                </div>
                                <div className="absolute left-1/2 -translate-x-1/2 logo-wrapper cursor-pointer" onClick={navigateToHome}>
                                    <img src="https://i.postimg.cc/9fx1vwqg/Logo-Ay-P.png" className="h-16 w-auto object-contain logo-img" alt="Logo" />
                                </div>
                                <div className="flex items-center justify-end gap-3 w-1/3">
                                    <OnlineUsers user={user} />
                                    <button className="p-2 text-slate-500 hover:text-slate-900" onClick={() => setIsLoginModalOpen(true)}><Lock size={20} /></button>
                                    <button className="relative p-2 text-slate-800 hover:bg-slate-100 rounded-full transition-colors" onClick={() => setIsCartOpen(true)}>
                                        <ShoppingCart size={24} />
                                        {cart.length > 0 && <span className="absolute top-0 right-0 w-4 h-4 bg-red-500 text-white text-[10px] flex items-center justify-center rounded-full font-bold shadow-sm">{cart.reduce((a,c)=>a+c.qty,0)}</span>}
                                    </button>
                                </div>
                            </div>
                        </nav>
                    )}

                    <Sidebar isOpen={isSidebarOpen} onClose={() => setIsSidebarOpen(false)} categories={categories} activeCategory={filters.league} onSelectCategory={(c) => setFilters({...filters, league: c})} contacts={contacts} setView={setCurrentView} />

                    {currentView === 'home' && (
                        <main className="relative z-10 max-w-7xl mx-auto px-4 py-8">
                            <div className="mb-8 space-y-4">
                                <div className="flex flex-wrap gap-2 justify-center md:justify-start items-center">
                                    {/* Botones de filtro mejorados - Light Mode */}
                                    <button onClick={() => setFilters({...filters, type: 'Todos'})} className={`px-4 py-1.5 rounded-full text-sm font-medium border transition-all flex items-center gap-2 ${filters.type==='Todos'?'bg-slate-800 text-white shadow-md':'bg-white text-slate-600 border-slate-200 hover:bg-slate-50'}`}>
                                        <Layers size={14}/> Todo
                                    </button>
                                    <button onClick={() => setFilters({...filters, type: 'Actual'})} className={`px-4 py-1.5 rounded-full text-sm font-medium border transition-all flex items-center gap-2 ${filters.type==='Actual'?'bg-green-100 text-green-700 border-green-300':'bg-white text-slate-600 border-slate-200 hover:bg-slate-50'}`}>
                                        <Zap size={14}/> Actual
                                    </button>
                                    <button onClick={() => setFilters({...filters, type: 'Retro'})} className={`px-4 py-1.5 rounded-full text-sm font-medium border transition-all flex items-center gap-2 ${filters.type==='Retro'?'bg-amber-100 text-amber-800 border-amber-300':'bg-white text-slate-600 border-slate-200 hover:bg-slate-50'}`}>
                                        <History size={14}/> Retro
                                    </button>
                                    <button onClick={navigateToPopular} className="px-4 py-1.5 rounded-full text-sm font-medium border border-yellow-200 bg-yellow-50 text-yellow-700 hover:bg-yellow-100 flex items-center gap-1 shadow-sm"><Star size={14}/> Top 5</button>
                                </div>
                                <div className="flex gap-3 overflow-x-auto pb-2 scrollbar-hide">
                                    <select className="bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm text-slate-700 glass-select min-w-[140px] focus:border-cyan-500 outline-none shadow-sm" value={filters.league} onChange={e=>setFilters({...filters, league: e.target.value})}><option value="Todas">Todas las Ligas</option>{categories.map(c=><option key={c.id} value={c.name}>{c.name}</option>)}</select>
                                    <select className="bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm text-slate-700 glass-select min-w-[140px] focus:border-cyan-500 outline-none shadow-sm" value={filters.size} onChange={e=>setFilters({...filters, size: e.target.value})}><option value="Todos">Todos los Talles</option>{["XS","S","M","L","XL","XXL","3XL"].map(s=><option key={s} value={s}>{s}</option>)}</select>
                                    <input type="text" placeholder="Filtrar por Color" className="bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm text-slate-700 w-40 focus:border-cyan-500 outline-none shadow-sm" value={filters.color} onChange={e=>setFilters({...filters, color: e.target.value})} />
                                </div>
                            </div>

                            {filteredProducts.length === 0 ? <div className="text-center py-20 text-slate-400">No hay productos.</div> : (
                                <>
                                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                                        {displayedProducts.map(p => {
                                            const hasStock = p.stock && Object.values(p.stock).some(v => v > 0);
                                            return (
                                                <div key={p.id} className="group bg-white border border-slate-100 hover:border-cyan-200 rounded-2xl overflow-hidden transition-all hover:shadow-xl hover:-translate-y-1 cursor-pointer" onClick={() => navigateToProduct(p)}>
                                                    <div className="relative">
                                                        <img src={p.images[0]} className="w-full h-64 object-cover" />
                                                        <div className="absolute top-2 left-2 flex flex-col gap-1 items-start">
                                                            {/* Etiquetas limpias */}
                                                            {!hasStock && <span className="bg-red-500 text-white text-[10px] px-2 py-1 rounded font-bold shadow-sm">AGOTADO</span>}
                                                            {p.discountPercent > 0 && <span className="bg-green-500 text-white text-[10px] px-2 py-1 rounded font-bold shadow-sm">{p.discountPercent}% OFF</span>}
                                                            {p.type === 'Retro' && <span className="bg-amber-400 text-white text-[10px] px-2 py-1 rounded font-bold shadow-sm flex items-center gap-1"><History size={10}/> RETRO</span>}
                                                            {p.type === 'Actual' && <span className="bg-blue-500 text-white text-[10px] px-2 py-1 rounded font-bold shadow-sm flex items-center gap-1"><Zap size={10}/> ACTUAL</span>}
                                                        </div>
                                                    </div>
                                                    <div className="p-4">
                                                        <h3 className="text-slate-800 font-bold leading-tight mb-2 truncate">{p.name}</h3>
                                                        <div className="flex items-center gap-2">
                                                            <span className="text-xl font-bold text-slate-900">${p.price.toLocaleString()}</span>
                                                            {p.discountPercent > 0 && <span className="text-sm text-slate-400 line-through decoration-slate-400">${p.originalPrice.toLocaleString()}</span>}
                                                        </div>
                                                    </div>
                                                </div>
                                            )
                                        })}
                                    </div>
                                    
                                    {totalPages > 1 && (
                                        <div className="flex justify-center gap-2">
                                            <button onClick={() => setCurrentPage(p => Math.max(1, p - 1))} disabled={currentPage === 1} className={`px-4 py-2 rounded-lg ${currentPage === 1 ? 'bg-slate-100 text-slate-400 cursor-not-allowed' : 'bg-white text-slate-700 hover:bg-slate-50 border border-slate-200 shadow-sm'}`}>Anterior</button>
                                            <span className="px-4 py-2 text-slate-500">P√°gina {currentPage} de {totalPages}</span>
                                            <button onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))} disabled={currentPage === totalPages} className={`px-4 py-2 rounded-lg ${currentPage === totalPages ? 'bg-slate-100 text-slate-400 cursor-not-allowed' : 'bg-white text-slate-700 hover:bg-slate-50 border border-slate-200 shadow-sm'}`}>Siguiente</button>
                                        </div>
                                    )}
                                </>
                            )}
                        </main>
                    )}

                    {currentView === 'popular' && (
                        <PopularView products={products} onBack={navigateToHome} onSelectProduct={navigateToProduct} />
                    )}

                    {currentView === 'product' && selectedProduct && (
                        <ProductDetailView product={selectedProduct} onClose={navigateToHome} addToCart={addToCart} cart={cart} />
                    )}

                    {isCartOpen && (
                        <div className="fixed inset-0 z-[60] flex justify-end">
                            <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" onClick={() => setIsCartOpen(false)} />
                            <div className="relative w-full max-w-md bg-white h-full shadow-2xl flex flex-col border-l border-slate-100 transform transition-transform">
                                <div className="p-6 border-b border-slate-100 flex justify-between items-center"><h2 className="text-xl font-bold text-slate-800 flex items-center gap-2"><ShoppingCart /> Tu Pedido</h2><button onClick={() => setIsCartOpen(false)}><X className="text-slate-500 hover:text-slate-800"/></button></div>
                                <div className="flex-1 overflow-y-auto p-6 space-y-4">
                                    {cart.length === 0 ? <div className="text-center text-slate-400 mt-10">El carrito est√° vac√≠o.</div> : cart.map((item, i) => (
                                        <div key={i} className="flex gap-4 p-3 bg-slate-50 rounded-xl border border-slate-100">
                                            <img src={item.images[0]} className="w-16 h-16 rounded-lg object-contain bg-white border border-slate-100" />
                                            <div className="flex-1">
                                                <h4 className="text-slate-800 font-medium">{item.name}</h4>
                                                <p className="text-sm text-slate-500">Talle: {item.size} | x{item.qty}</p>
                                                <p className="text-cyan-600 font-bold">${(item.price * item.qty).toLocaleString()}</p>
                                            </div>
                                            <button onClick={() => removeFromCart(item.id, item.size)} className="text-slate-400 hover:text-red-500"><Trash2 size={18} /></button>
                                        </div>
                                    ))}
                                </div>
                                <div className="p-6 bg-slate-50 border-t border-slate-100">
                                    <div className="flex gap-2 mb-4">
                                        <input type="text" placeholder="Cup√≥n de descuento" className="flex-1 bg-white border border-slate-200 rounded-lg px-3 py-2 text-slate-900 outline-none focus:border-cyan-500" value={couponInput} onChange={e => setCouponInput(e.target.value)} />
                                        <button onClick={applyCoupon} className="px-4 bg-slate-200 hover:bg-slate-300 rounded-lg text-slate-700 font-medium transition-colors">Aplicar</button>
                                    </div>
                                    <div className="flex justify-between items-center mb-4 text-lg font-bold text-slate-800">
                                        <span>Total</span>
                                        <span>${(cart.reduce((a,c)=>a+c.price*c.qty,0) * (1 - appliedDiscount/100)).toLocaleString()}</span>
                                    </div>
                                    <button onClick={() => setIsBuyerFormOpen(true)} className="w-full py-4 bg-green-600 hover:bg-green-500 text-white rounded-xl font-bold flex justify-center gap-2 shadow-lg hover:shadow-green-500/20 transition-all"><CheckCircle /> Confirmar Compra</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <LoginModal isOpen={isLoginModalOpen} onClose={() => setIsLoginModalOpen(false)} onLogin={handleLoginSubmit} />
                    {isBuyerFormOpen && <BuyerForm onSubmit={handleBuyerFormSubmit} onClose={() => setIsBuyerFormOpen(false)} />}
                    {isAdminOpen && <AdminPanel products={products} setProducts={setProducts} categories={categories} setCategories={setCategories} pendingOrders={pendingOrders} onDeductStock={handleStockDeduction} contacts={contacts} setContacts={setContacts} coupons={coupons} setCoupons={setCoupons} marqueeText={marqueeText} setMarqueeText={setMarqueeText} showMarquee={showMarquee} setShowMarquee={setShowMarquee} onClose={() => setIsAdminOpen(false)} />}
                    {generatedOrder && <TicketView order={generatedOrder} onClose={() => setGeneratedOrder(null)} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
```

### Reglas de Seguridad para Firebase (Firestore)

Para solucionar el problema de que "no se guarda nada", debes actualizar las reglas en tu consola de Firebase.

1.  Ve a **Firebase Console** -> **Firestore Database** -> Pesta√±a **Reglas**.
2.  Borra lo que haya y pega exactamente esto:

```text
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Funci√≥n auxiliar para verificar si el usuario es administrador (opcional, por ahora permitimos escritura p√∫blica para evitar bloqueos, pero idealmente deber√≠as usar autenticaci√≥n)
    function isAdmin() {
      return true; // En producci√≥n, cambiar esto por: request.auth != null;
    }

    // Regla global: Permitir lectura y escritura a cualquier usuario en tu ruta espec√≠fica
    // IMPORTANTE: Aseg√∫rate de usar tu APP_ID correcto en el c√≥digo (ayp-camisetas-prod-v2)
    match /artifacts/{appId}/public/data/{document=**} {
      allow read, write: if true;
    }
    
    // Regla de respaldo por si acaso se usan otras rutas
    match /{document=**} {
      allow read, write: if true; 
    }
  }
}
